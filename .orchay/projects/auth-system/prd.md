# Auth System PRD (Product Requirements Document)

## 1. 개요

### 1.1 프로젝트명
Auth System - RBAC 기반 AAA 권한 관리 시스템

### 1.2 목적
MES Portal에 통합되는 인증(Authentication), 인가(Authorization), 회계(Accounting) 기능을 제공하는 RBAC 기반 권한 관리 시스템 개발

### 1.3 배경
- 제조 현장의 보안 요구사항 강화
- 역할 기반 접근 제어(RBAC)를 통한 체계적인 권한 관리 필요
- 감사 로그를 통한 보안 추적성 확보
- MES Portal과의 통합 인증/인가 체계 구축

### 1.4 범위
- **포함**: 인증(Authentication), 인가(Authorization), 회계(Accounting)
- **제외**: SSO 연동 (Phase 2), MFA (Phase 2)

---

## 2. 목표

### 2.1 비즈니스 목표
- 사용자 인증 및 접근 제어 체계 확립
- 역할 기반 권한 관리로 업무 효율성 향상
- 감사 로그를 통한 보안 컴플라이언스 충족
- 보안 사고 예방 및 추적성 확보

### 2.2 기술 목표
- JWT 기반 Stateless 인증 시스템
- RBAC(Role-Based Access Control) 권한 모델 구현
- 메뉴/화면/API 레벨의 세분화된 접근 제어
- 실시간 감사 로그 수집 및 조회

---

## 3. 사용자

### 3.1 주요 사용자
| 사용자 유형 | 역할 | 주요 기능 |
|------------|------|----------|
| 시스템 관리자 | 전체 시스템 관리 | 사용자/역할/권한 관리, 감사 로그 조회 |
| 보안 관리자 | 보안 정책 관리 | 보안 설정, 감사 로그 모니터링 |
| 일반 관리자 | 부서/팀 사용자 관리 | 제한된 사용자 관리 |
| 일반 사용자 | 업무 수행 | 권한 범위 내 메뉴/기능 사용 |

### 3.2 역할 계층 (기본 제공)
```
시스템 관리자 (SYSTEM_ADMIN)
├── 보안 관리자 (SECURITY_ADMIN)
├── 운영 관리자 (OPERATION_ADMIN)
│   ├── 생산 관리자 (PRODUCTION_MANAGER)
│   ├── 품질 관리자 (QUALITY_MANAGER)
│   └── 설비 관리자 (EQUIPMENT_MANAGER)
└── 일반 사용자 (USER)
```

---

## 4. 기능 요구사항

### 4.1 인증 (Authentication)

#### 4.1.1 로그인/로그아웃
- [ ] 로그인 화면 (아이디/비밀번호)
- [ ] 로그인 유효성 검사 (필수 입력, 형식 검증)
- [ ] 로그인 실패 메시지 (아이디 또는 비밀번호 오류)
- [ ] 자동 로그인 (Remember Me) 옵션
- [ ] 로그아웃 기능
- [ ] 로그아웃 시 세션 무효화

#### 4.1.2 JWT 토큰 관리
- [ ] Access Token 발급 (단기 유효, 기본 15분)
- [ ] Refresh Token 발급 (장기 유효, 기본 7일)
- [ ] Access Token 자동 갱신 (만료 전 자동 연장)
- [ ] Refresh Token Rotation (갱신 시 새 토큰 발급)
- [ ] 토큰 블랙리스트 관리 (로그아웃/강제 만료)

#### 4.1.3 세션 관리
- [ ] 세션 타임아웃 설정 (기본 30분 비활성 시)
- [ ] 세션 만료 경고 (만료 5분 전 알림)
- [ ] 세션 연장 기능 (사용자 요청 시)
- [ ] 동시 세션 제한 (최대 N개 기기)
- [ ] 다른 기기 세션 강제 종료

#### 4.1.4 비밀번호 정책
- [ ] 비밀번호 복잡도 규칙
  - [ ] 최소 길이 (기본 8자)
  - [ ] 대문자 포함 필수
  - [ ] 소문자 포함 필수
  - [ ] 숫자 포함 필수
  - [ ] 특수문자 포함 필수
- [ ] 비밀번호 만료 기간 (기본 90일)
- [ ] 비밀번호 만료 알림 (만료 7일 전)
- [ ] 비밀번호 이력 관리 (최근 N개 재사용 금지)
- [ ] 초기 비밀번호 변경 강제

#### 4.1.5 계정 잠금
- [ ] 로그인 실패 횟수 제한 (기본 5회)
- [ ] 계정 잠금 시간 (기본 30분 자동 해제)
- [ ] 관리자에 의한 계정 잠금/해제
- [ ] 계정 잠금 알림 (이메일/시스템 알림)

#### 4.1.6 비밀번호 찾기/재설정
- [ ] 비밀번호 찾기 요청 (이메일 인증)
- [ ] 비밀번호 재설정 링크 발송
- [ ] 재설정 링크 유효 시간 (기본 1시간)
- [ ] 새 비밀번호 설정 화면

---

### 4.2 인가 (Authorization) - RBAC

#### 4.2.1 역할 (Role) 관리
- [ ] 역할 목록 조회
- [ ] 역할 등록
  - [ ] 역할 코드 (고유, 영문 대문자)
  - [ ] 역할명 (한글)
  - [ ] 역할 설명
  - [ ] 상위 역할 (계층 구조)
  - [ ] 활성화 상태
- [ ] 역할 수정
- [ ] 역할 삭제 (사용 중인 역할 삭제 불가)
- [ ] 역할 복제 (기존 역할 기반 생성)

#### 4.2.2 권한 (Permission) 관리
- [ ] 권한 목록 조회
- [ ] 권한 등록
  - [ ] 권한 코드 (고유, 리소스:액션 형식)
  - [ ] 권한명 (한글)
  - [ ] 권한 유형 (메뉴/화면/API/데이터)
  - [ ] 리소스 경로
  - [ ] 권한 설명
- [ ] 권한 수정
- [ ] 권한 삭제

#### 4.2.3 역할-권한 매핑
- [ ] 역할별 권한 조회
- [ ] 역할에 권한 할당
- [ ] 역할에서 권한 제거
- [ ] 권한 일괄 할당/제거
- [ ] 권한 매핑 매트릭스 뷰

#### 4.2.4 사용자-역할 할당
- [ ] 사용자별 역할 조회
- [ ] 사용자에 역할 할당 (다중 역할 가능)
- [ ] 사용자에서 역할 제거
- [ ] 역할별 사용자 목록 조회

#### 4.2.5 메뉴 접근 제어
- [ ] 권한별 메뉴 필터링
- [ ] 메뉴-권한 매핑 관리
- [ ] 동적 메뉴 생성 (권한 기반)
- [ ] 메뉴 비가시화 (권한 없는 메뉴 숨김)

#### 4.2.6 화면 요소 제어
- [ ] 버튼 활성화/비활성화
- [ ] 필드 읽기 전용/편집 가능
- [ ] 영역 표시/숨김
- [ ] 화면 요소-권한 매핑

#### 4.2.7 API 접근 제어
- [ ] API 엔드포인트별 권한 체크
- [ ] HTTP 메서드별 권한 분리 (GET/POST/PUT/DELETE)
- [ ] 데이터 필터링 (권한 범위 내 데이터만 조회)
- [ ] 403 Forbidden 응답 처리

---

### 4.3 회계 (Accounting) - 감사 로그

#### 4.3.1 인증 로그
- [ ] 로그인 성공 기록
  - [ ] 사용자 ID
  - [ ] 로그인 시간
  - [ ] IP 주소
  - [ ] User-Agent (브라우저/기기 정보)
  - [ ] 로그인 방식 (일반/자동로그인)
- [ ] 로그인 실패 기록
  - [ ] 입력 사용자 ID
  - [ ] 실패 사유
  - [ ] 시도 시간
  - [ ] IP 주소
- [ ] 로그아웃 기록
- [ ] 세션 만료 기록
- [ ] 비밀번호 변경 기록

#### 4.3.2 권한 변경 로그
- [ ] 역할 생성/수정/삭제 기록
- [ ] 권한 생성/수정/삭제 기록
- [ ] 역할-권한 매핑 변경 기록
- [ ] 사용자-역할 할당 변경 기록
- [ ] 계정 잠금/해제 기록

#### 4.3.3 접근 감사 로그
- [ ] 메뉴/화면 접근 기록
- [ ] 주요 데이터 조회 기록
- [ ] 데이터 생성/수정/삭제 기록
- [ ] 파일 다운로드 기록
- [ ] 권한 없는 접근 시도 기록

#### 4.3.4 감사 로그 조회
- [ ] 로그 목록 조회 (페이징)
- [ ] 필터링 (기간, 사용자, 이벤트 유형, IP)
- [ ] 상세 조회
- [ ] 로그 내보내기 (CSV, Excel)
- [ ] 로그 보존 기간 설정

#### 4.3.5 보안 이벤트 알림
- [ ] 반복 로그인 실패 알림
- [ ] 계정 잠금 알림
- [ ] 권한 없는 접근 시도 알림
- [ ] 비정상 접근 패턴 알림
- [ ] 알림 채널 설정 (이메일, 시스템 알림)

---

### 4.4 관리 화면

#### 4.4.1 사용자 관리
- [ ] 사용자 목록 조회 (검색, 필터, 페이징)
- [ ] 사용자 등록
  - [ ] 사용자 ID (고유)
  - [ ] 이름
  - [ ] 이메일
  - [ ] 부서/팀
  - [ ] 연락처
  - [ ] 역할 할당
  - [ ] 활성화 상태
- [ ] 사용자 수정
- [ ] 사용자 삭제 (비활성화)
- [ ] 비밀번호 초기화
- [ ] 계정 잠금/해제
- [ ] 세션 강제 종료

#### 4.4.2 역할 관리 화면
- [ ] 역할 목록 (트리/리스트 뷰)
- [ ] 역할 CRUD 폼
- [ ] 역할-권한 매핑 인터페이스
- [ ] 역할별 사용자 목록

#### 4.4.3 권한 관리 화면
- [ ] 권한 목록 (그룹별 분류)
- [ ] 권한 CRUD 폼
- [ ] 권한 매핑 매트릭스
- [ ] 미사용 권한 정리

#### 4.4.4 감사 로그 조회 화면
- [ ] 로그 검색/필터링 UI
- [ ] 로그 타임라인 뷰
- [ ] 로그 상세 모달
- [ ] 내보내기 기능

#### 4.4.5 보안 설정 화면
- [ ] 비밀번호 정책 설정
- [ ] 세션 정책 설정
- [ ] 계정 잠금 정책 설정
- [ ] 로그 보존 정책 설정
- [ ] 알림 설정

---

## 5. 비기능 요구사항

### 5.1 보안
- JWT 토큰 암호화 (RS256 또는 HS256)
- HTTPS 필수 적용
- 비밀번호 해싱 (bcrypt, 최소 10 rounds)
- SQL Injection 방지
- XSS 방지
- CSRF 토큰 적용

### 5.2 성능
- 로그인 응답 시간: 1초 이내
- 권한 검사 응답 시간: 100ms 이내
- 동시 사용자: 1,000명 이상 지원
- 감사 로그 쿼리: 3초 이내 (100만 건 기준)

### 5.3 가용성
- 시스템 가용성: 99.9% 이상
- 장애 복구 시간: 1시간 이내
- 데이터 백업: 일 1회 이상

### 5.4 확장성
- 수평 확장 가능한 Stateless 구조
- 역할/권한 수: 제한 없음
- 사용자 수: 10,000명 이상 지원

---

## 6. 제약사항

### 6.1 기술 제약
- Next.js 16.x / React 19.x 환경
- Ant Design 6.x 컴포넌트 사용
- JWT 기반 인증 (세션 기반 X)

### 6.2 운영 제약
- 기존 사용자 데이터 마이그레이션 지원
- 하위 호환성 유지

### 6.3 제외 범위
- SSO (Single Sign-On) - Phase 2
- MFA (Multi-Factor Authentication) - Phase 2
- OAuth 2.0 / OIDC 연동 - Phase 2
- LDAP/AD 연동 - Phase 2

---

## 7. 용어 정의

| 용어 | 설명 |
|------|------|
| AAA | Authentication(인증), Authorization(인가), Accounting(회계)의 약자 |
| RBAC | Role-Based Access Control, 역할 기반 접근 제어 |
| JWT | JSON Web Token, 클레임 기반 인증 토큰 |
| Access Token | 리소스 접근용 단기 토큰 |
| Refresh Token | Access Token 갱신용 장기 토큰 |
| Role | 역할, 권한의 집합 |
| Permission | 권한, 특정 리소스에 대한 접근 허가 |
| Session | 사용자의 로그인 상태를 유지하는 기간 |
| Audit Log | 감사 로그, 시스템 사용 이력 기록 |

---

## 8. 변경 이력

| 버전 | 작성일 | 작성자 | 변경 내용 |
|------|--------|--------|----------|
| 0.1 | 2026-01-26 | Claude | 초안 작성 - RBAC 기반 AAA 시스템 PRD |
