# 단위 테스트 결과서 (070-tdd-test-results.md)

**Task ID:** TSK-03-01
**Task명:** 역할/권한 CRUD API
**Last Updated:** 2026-01-26

---

## 0. 문서 메타데이터

| 항목 | 내용 |
|------|------|
| Task ID | TSK-03-01 |
| Task명 | 역할/권한 CRUD API |
| 테스트 일시 | 2026-01-26 |
| 테스트 환경 | Node.js 20.x, Vitest 4.0.17 |
| 상세설계 문서 | `010-design.md` |

---

## 1. 테스트 요약

### 1.1 전체 결과

| 항목 | 수치 | 상태 |
|------|------|------|
| 총 테스트 파일 | 4개 | ✅ |
| 총 테스트 케이스 | 52개 | ✅ |
| 통과 | 52개 | ✅ |
| 실패 | 0개 | ✅ |
| 빌드 | 성공 | ✅ |

### 1.2 테스트 판정

- [x] **PASS**: 모든 테스트 통과, 빌드 성공

---

## 2. 테스트 파일별 결과

### 2.1 역할 API 테스트

**파일**: `app/api/roles/__tests__/route.test.ts`

| 테스트 ID | 테스트명 | 결과 |
|----------|---------|------|
| UT-ROLE-001 | 인증되지 않은 요청은 401 반환 | ✅ |
| UT-ROLE-002 | 역할 목록 조회 성공 | ✅ |
| UT-ROLE-003 | 페이지네이션 파라미터 적용 | ✅ |
| UT-ROLE-004 | 검색어 필터링 | ✅ |
| UT-ROLE-005 | 활성화 상태 필터링 | ✅ |
| UT-ROLE-006 | 인증되지 않은 요청은 401 반환 | ✅ |
| UT-ROLE-007 | 관리자가 아닌 사용자는 403 반환 | ✅ |
| UT-ROLE-008 | 필수 필드 누락 시 400 반환 | ✅ |
| UT-ROLE-009 | 중복 코드로 생성 시 409 반환 | ✅ |
| UT-ROLE-010 | 역할 생성 성공 | ✅ |
| UT-ROLE-011 | 부모 역할이 있을 때 레벨 자동 계산 | ✅ |
| UT-ROLE-012 | 인증되지 않은 요청은 401 반환 | ✅ |
| UT-ROLE-013 | 존재하지 않는 역할 조회 시 404 반환 | ✅ |
| UT-ROLE-014 | 역할 상세 조회 성공 | ✅ |
| UT-ROLE-015 | 관리자가 아닌 사용자는 403 반환 | ✅ |
| UT-ROLE-016 | 존재하지 않는 역할 수정 시 404 반환 | ✅ |
| UT-ROLE-017 | 역할 수정 성공 | ✅ |
| UT-ROLE-018 | parentId 변경 시 레벨 재계산 | ✅ |
| UT-ROLE-019 | 관리자가 아닌 사용자는 403 반환 | ✅ |
| UT-ROLE-020 | 존재하지 않는 역할 삭제 시 404 반환 | ✅ |
| UT-ROLE-021 | 시스템 역할(BR-03-01) 삭제 시 400 반환 | ✅ |
| UT-ROLE-022 | 일반 역할 삭제 성공 | ✅ |

**소계: 22/22 통과**

### 2.2 권한 API 테스트

**파일**: `app/api/permissions/__tests__/route.test.ts`

| 테스트 ID | 테스트명 | 결과 |
|----------|---------|------|
| UT-PERM-001 | 인증되지 않은 요청은 401 반환 | ✅ |
| UT-PERM-002 | 권한 목록 조회 성공 | ✅ |
| UT-PERM-003 | 타입별 필터링 | ✅ |
| UT-PERM-004 | 검색어 필터링 | ✅ |
| UT-PERM-005 | 인증되지 않은 요청은 401 반환 | ✅ |
| UT-PERM-006 | 관리자가 아닌 사용자는 403 반환 | ✅ |
| UT-PERM-007 | 필수 필드 누락 시 400 반환 | ✅ |
| UT-PERM-008 | 중복 코드로 생성 시 409 반환 | ✅ |
| UT-PERM-009 | 권한 생성 성공 | ✅ |
| UT-PERM-010 | 인증되지 않은 요청은 401 반환 | ✅ |
| UT-PERM-011 | 존재하지 않는 권한 조회 시 404 반환 | ✅ |
| UT-PERM-012 | 권한 상세 조회 성공 | ✅ |
| UT-PERM-013 | 관리자가 아닌 사용자는 403 반환 | ✅ |
| UT-PERM-014 | 존재하지 않는 권한 수정 시 404 반환 | ✅ |
| UT-PERM-015 | 권한 수정 성공 | ✅ |
| UT-PERM-016 | 관리자가 아닌 사용자는 403 반환 | ✅ |
| UT-PERM-017 | 존재하지 않는 권한 삭제 시 404 반환 | ✅ |
| UT-PERM-018 | 권한 삭제 성공 | ✅ |

**소계: 18/18 통과**

### 2.3 역할-권한 매핑 API 테스트

**파일**: `app/api/roles/[id]/permissions/__tests__/route.test.ts`

| 테스트 ID | 테스트명 | 결과 |
|----------|---------|------|
| UT-RP-001 | 인증되지 않은 요청은 401 반환 | ✅ |
| UT-RP-002 | 관리자가 아닌 사용자는 403 반환 | ✅ |
| UT-RP-003 | 존재하지 않는 역할에 대해 404 반환 | ✅ |
| UT-RP-004 | permissionIds가 누락되면 400 반환 | ✅ |
| UT-RP-005 | 역할-권한 매핑 성공 | ✅ |
| UT-RP-006 | 빈 배열로 모든 권한 해제 | ✅ |

**소계: 6/6 통과**

### 2.4 사용자-역할 할당 API 테스트

**파일**: `app/api/users/[id]/roles/__tests__/route.test.ts`

| 테스트 ID | 테스트명 | 결과 |
|----------|---------|------|
| UT-UR-001 | 인증되지 않은 요청은 401 반환 | ✅ |
| UT-UR-002 | 관리자가 아닌 사용자는 403 반환 | ✅ |
| UT-UR-003 | 존재하지 않는 사용자에 대해 404 반환 | ✅ |
| UT-UR-004 | roleIds가 누락되면 400 반환 | ✅ |
| UT-UR-005 | 사용자-역할 할당 성공 | ✅ |
| UT-UR-006 | 빈 배열로 모든 역할 해제 | ✅ |

**소계: 6/6 통과**

---

## 3. 빌드 결과

### 3.1 실행 명령어

```bash
pnpm build
```

### 3.2 실행 결과

```
✓ Compiled successfully

Route (app)
├ ƒ /api/permissions
├ ƒ /api/permissions/[id]
├ ƒ /api/roles
├ ƒ /api/roles/[id]
├ ƒ /api/roles/[id]/permissions
├ ƒ /api/users/[id]/roles
```

---

## 4. 품질 게이트 결과

| 게이트 | 기준 | 실제 | 결과 |
|--------|------|------|------|
| 테스트 통과율 | 100% | 100% (52/52) | ✅ |
| 빌드 성공 | 에러 없음 | 에러 없음 | ✅ |
| 타입 체크 | 에러 없음 | 에러 없음 | ✅ |

**최종 판정**: ✅ PASS

---

## 5. 다음 단계

- TSK-03-01 완료 처리
- TSK-03-02 (메뉴/API 접근 제어 미들웨어) 진행

---

## 관련 문서

- 상세설계: `010-design.md`
- 테스트 명세: `026-test-specification.md`
- 구현 문서: `030-implementation.md`
- 추적성 매트릭스: `025-traceability-matrix.md`
