# TSK-02-05 설계 리뷰 보고서

## 문서 정보

| 항목 | 내용 |
|------|------|
| Task ID | TSK-02-05 |
| Task명 | MDI 컨텐츠 영역 |
| 리뷰어 | claude-1 |
| 리뷰일 | 2026-01-20 |
| 설계 문서 버전 | 1.0 |

---

## 1. 검증 대상

| 문서 | 상태 | 비고 |
|------|------|------|
| 010-design.md | ✅ 검토완료 | 통합 설계 문서 |
| 025-traceability-matrix.md | ✅ 검토완료 | 추적성 매트릭스 |
| 026-test-specification.md | ✅ 검토완료 | 테스트 명세 |

---

## 2. 검증 결과 요약

| 검증 영역 | 평가 | 비고 |
|----------|------|------|
| 문서 완전성 | PASS | 필수 섹션 모두 포함 |
| 요구사항 추적성 | PASS | PRD/WBS 요구사항 매핑 완료 |
| 아키텍처 | WARN | 2건 개선 필요 (ErrorBoundary 격리, 메모리 관리) |
| 보안 | WARN | 2건 개선 필요 (권한 검증, 민감 정보 보호) |
| 테스트 가능성 | WARN | 2건 보완 필요 (에러 케이스, 스크롤 테스트) |

**이슈 분포**: P1(4) P2(4) P3(2) P4(2) P5(1) = **13건**

---

## 3. 상세 이슈 목록

### 3.1 아키텍처 관점

#### [High]-ARCH-01: ErrorBoundary 배치 위치 및 격리 수준 불명확

| 항목 | 내용 |
|------|------|
| **영역** | 컴포넌트 분할 / 에러 처리 |
| **심각도** | High |
| **우선순위** | P1 |

**현재 설계**:
```
MDIContent
  └── ErrorBoundary
        └── Suspense
              └── Screen Component
```

**문제점**:
- 단일 ErrorBoundary로 인해 하나의 탭 에러가 전체 MDIContent를 에러 폴백으로 전환할 수 있음
- Tab A 에러가 Tab B, C에 영향을 줌
- 개별 탭 복구 메커니즘 부재

**개선 제안**:
```
MDIContent
  ├── TabPane (Tab A)
  │     └── ErrorBoundary (A)     # 탭별 격리
  │           └── Suspense
  │                 └── Screen A
  ├── TabPane (Tab B)
  │     └── ErrorBoundary (B)     # 탭별 격리
  ...
```

---

#### [High]-ARCH-02: 대량 탭 시 메모리 관리 전략 부재

| 항목 | 내용 |
|------|------|
| **영역** | 성능 / 확장성 |
| **심각도** | High |
| **우선순위** | P1 |

**현재 설계**:
- BR-01: 비활성 탭은 unmount하지 않고 display:none 유지
- 제약사항: 최대 탭 10개 제한

**문제점**:
- 10개 탭 모두 복잡한 화면(대시보드, 대용량 테이블)일 경우 메모리 사용량 급증
- 탭별 리소스(WebSocket, setInterval) 관리 방안 없음
- LRU 기반 자동 정리 메커니즘 부재

**개선 제안**:
1. 계층적 상태 보존 전략: 최근 N개 탭만 DOM 유지, 나머지는 상태만 Context에 저장
2. `useTabLifecycle` 훅으로 탭 비활성화 시 리소스 정리 지원
3. 메모리 임계치 초과 시 자동 정리

---

#### [Medium]-ARCH-03: ScreenLoader의 다중 책임 문제

| 항목 | 내용 |
|------|------|
| **영역** | SOLID (단일 책임 원칙) |
| **심각도** | Medium |
| **우선순위** | P2 |

**현재 설계**:
ScreenLoader가 screenRegistry 조회, React.lazy 로딩, 404 처리를 모두 담당

**문제점**:
- 세 가지 관심사가 혼재되어 테스트 및 확장 어려움
- 새로운 로딩 전략(prefetch, preload) 추가 시 수정 범위 증가

**개선 제안**:
```
lib/mdi/
├── screenRegistry.ts       # 데이터만
├── screenResolver.ts       # 경로 → 컴포넌트 해석 (NEW)
└── useScreenLoader.ts      # 로딩 상태 관리 훅 (NEW)
```

---

#### [Medium]-ARCH-04: screenRegistry 확장성 - 하드코딩된 매핑 구조

| 항목 | 내용 |
|------|------|
| **영역** | SOLID (개방-폐쇄 원칙) |
| **심각도** | Medium |
| **우선순위** | P2 |

**현재 설계**:
```typescript
const screenRegistry = {
  '/dashboard': () => import('@/screens/dashboard/Dashboard'),
  // 수동 매핑
};
```

**문제점**:
- 새 화면 추가 시 반드시 screenRegistry 파일 수정 필요
- 메뉴 DB 데이터와 이중 관리로 불일치 가능

**개선 제안**:
선언적 등록 패턴 도입 - 각 화면 파일에서 메타데이터와 함께 자기 등록

---

### 3.2 보안 관점

#### [High]-SEC-01: 화면 레벨 권한 검사 누락

| 항목 | 내용 |
|------|------|
| **영역** | 권한검증 |
| **심각도** | High |
| **우선순위** | P1 |
| **OWASP** | A01:2021 - Broken Access Control |

**현재 설계**:
screenRegistry는 path와 컴포넌트를 단순 매핑하며, 권한 검사 로직 미구현

**보안 위험**:
- 사용자가 탭 데이터 조작으로 권한 없는 화면 접근 가능
- 메뉴 권한 필터링을 우회할 수 있음

**개선 제안**:
```typescript
const loadScreen = async (path: string, userRole: string) => {
  if (!screenRegistry[path]) return ScreenNotFound;

  const hasPermission = await checkScreenPermission(path, userRole);
  if (!hasPermission) return AccessDenied;

  return screenRegistry[path]();
};
```

---

#### [High]-SEC-02: 비활성 탭에 민감 정보 DOM 노출

| 항목 | 내용 |
|------|------|
| **영역** | 상태유지 |
| **심각도** | High |
| **우선순위** | P1 |
| **OWASP** | A01:2021 - Broken Access Control |

**현재 설계**:
비활성 탭을 `display: none`으로 DOM에 유지

**보안 위험**:
- 브라우저 개발자 도구로 숨겨진 민감 정보(급여, 개인정보) 접근 가능
- 자리 비운 사이 데이터 유출 가능

**개선 제안**:
- 민감 화면 분류 후 비활성 시 데이터 마스킹 또는 unmount
- 세션 타임아웃 시 민감 탭 자동 닫기

---

#### [Medium]-SEC-03: 경로 화이트리스트 검증 부재

| 항목 | 내용 |
|------|------|
| **영역** | 경로검증 |
| **심각도** | Medium |
| **우선순위** | P2 |
| **OWASP** | A03:2021 - Injection |

**현재 설계**:
tab.path에 대한 형식 검증 없이 screenRegistry 존재 여부만 확인

**보안 위험**:
- Path traversal (`/../..`) 시도 가능
- 프로토콜 인젝션 (`javascript:`) 시도 가능

**개선 제안**:
```typescript
const validateScreenPath = (path: string): boolean => {
  if (!path.startsWith('/')) return false;
  if (path.includes('..') || path.includes(':')) return false;
  return /^\/[a-zA-Z0-9\-\/]*$/.test(path) && path in screenRegistry;
};
```

---

#### [Medium]-SEC-04: 동적 Import 경로 하드닝 필요

| 항목 | 내용 |
|------|------|
| **영역** | 동적Import |
| **심각도** | Medium |
| **우선순위** | P2 |
| **OWASP** | A08:2021 - Software and Data Integrity |

**현재 설계**:
정적 매핑으로 현재는 안전하나, 확장 시 주의 필요

**개선 제안**:
- `Object.freeze(screenRegistry)` 처리
- 동적 경로 생성 패턴 금지 규칙 명시
- CSP 헤더로 스크립트 소스 제한

---

### 3.3 품질 관점

#### [High]-QA-01: 에러 케이스 테스트 커버리지 불완전

| 항목 | 내용 |
|------|------|
| **영역** | 에러커버리지 |
| **심각도** | High |
| **우선순위** | P1 |

**현재 상태**:
- 추적성 매트릭스에 TC-ERR-01 ~ TC-ERR-03 정의
- 테스트 명세서 2.2 상세 섹션에 TC-ERR-01만 존재

**문제점**:
- TC-ERR-02(화면 경로 없음), TC-ERR-03(렌더링 오류) 상세 정의 누락
- 네트워크 오류 시나리오 E2E 테스트 없음

**개선 제안**:
테스트 명세서 2.2에 TC-ERR-02, TC-ERR-03 상세 케이스 추가

---

#### [High]-QA-02: 스크롤 동작 요구사항 테스트 누락

| 항목 | 내용 |
|------|------|
| **영역** | 추적성 |
| **심각도** | High |
| **우선순위** | P1 |

**현재 상태**:
- PRD: "스크롤: 컨텐츠 영역 내부에서만 스크롤"
- 테스트 케이스에 스크롤 동작 검증 항목 없음

**개선 제안**:
- TC-SCROLL-01: overflow 스타일 적용 확인
- E2E-08: 스크롤 시 헤더/사이드바 고정 확인

---

#### [Medium]-QA-03: 최대 탭 개수 제한 테스트 누락

| 항목 | 내용 |
|------|------|
| **영역** | 테스트가능성 |
| **심각도** | Medium |
| **우선순위** | P2 |

**현재 상태**:
- 설계 문서에 "최대 탭 개수 제한 (기본 10개)" 명시
- 비즈니스 규칙 BR-05로 정의되지 않음
- 테스트 케이스 없음

**개선 제안**:
- BR-05 추가: "최대 탭 개수는 10개로 제한"
- TC-BR-05, E2E-06 테스트 케이스 추가

---

#### [Medium]-QA-04: 반응형 동작 E2E 테스트 누락

| 항목 | 내용 |
|------|------|
| **영역** | 테스트가능성 |
| **심각도** | Medium |
| **우선순위** | P2 |

**현재 상태**:
- 설계 문서 5.4에 반응형 동작 정의
- 매뉴얼 테스트 TC-UI-005만 존재

**개선 제안**:
E2E-07: 모바일/태블릿 뷰포트에서 레이아웃 검증 추가

---

#### [Low]-QA-05: 컴포넌트명 일관성 부족

| 항목 | 내용 |
|------|------|
| **영역** | 일관성 |
| **심각도** | Low |
| **우선순위** | P3 |

**현재 상태**:
- ScreenLoader가 11.4 컴포넌트 구조에 정의되나 화면 흐름도에 없음
- 각 컴포넌트 책임 명확하지 않음

**개선 제안**:
설계 문서에 컴포넌트별 책임 명시 추가

---

#### [Low]-QA-06: 에러 메시지 정보 노출 우려

| 항목 | 내용 |
|------|------|
| **영역** | 에러노출 |
| **심각도** | Low |
| **우선순위** | P3 |
| **OWASP** | A05:2021 - Security Misconfiguration |

**현재 설계**:
"요청하신 화면이 존재하지 않거나 접근 권한이 없습니다"

**문제점**:
권한 여부 힌트 제공으로 경로 열거 공격 가능

**개선 제안**:
통일된 에러 메시지: "요청하신 화면에 접근할 수 없습니다"

---

#### [Info]-QA-07: data-testid 네이밍 개선 권장

| 항목 | 내용 |
|------|------|
| **영역** | 테스트가능성 |
| **심각도** | Info |
| **우선순위** | P4 |

**현재 상태**:
`tab-pane-{id}`와 `tab-{id}` 혼재

**개선 제안**:
- 탭 바 아이템: `mdi-tab-item-{id}`
- 탭 패널: `mdi-tab-pane-{id}`

---

#### [Info]-ARCH-05: 의존성 인터페이스 명시화 권장

| 항목 | 내용 |
|------|------|
| **영역** | SOLID (의존성 역전) |
| **심각도** | Info |
| **우선순위** | P5 |

**개선 제안**:
ScreenRegistry, MDIContextValue 인터페이스를 명시적으로 정의하여 테스트 용이성 및 확장성 확보

---

## 4. 긍정적 평가

| 항목 | 평가 |
|------|------|
| 문서 구조 | 유즈케이스, 시나리오, 와이어프레임, 비즈니스 규칙이 체계적으로 구성됨 |
| 추적성 | PRD → 설계 → 테스트 양방향 추적 매트릭스가 잘 구성됨 |
| 테스트 상세도 | 테스트 코드 가이드가 포함되어 구현자가 바로 활용 가능 |
| 상태 설계 | 로딩/빈 상태/에러 상태에 대한 UI가 명확히 정의됨 |
| data-testid | E2E 테스트를 위한 셀렉터가 사전 정의됨 |

---

## 5. 조치 권장 우선순위

| 순위 | 이슈 ID | 내용 | 우선순위 |
|------|---------|------|----------|
| 1 | ARCH-01 | ErrorBoundary를 TabPane 단위로 격리 배치 | P1 |
| 2 | ARCH-02 | 탭 메모리 관리 전략 (LRU 기반) 설계 보완 | P1 |
| 3 | SEC-01 | 화면 레벨 권한 검사 로직 추가 | P1 |
| 4 | SEC-02 | 민감 화면 분류 및 비활성 시 보호 정책 | P1 |
| 5 | QA-01 | 에러 케이스 테스트 상세 명세 추가 | P1 |
| 6 | QA-02 | 스크롤 동작 테스트 케이스 추가 | P1 |
| 7 | ARCH-03 | ScreenLoader 책임 분리 | P2 |
| 8 | ARCH-04 | screenRegistry 확장성 개선 | P2 |
| 9 | SEC-03 | 경로 검증 유틸리티 추가 | P2 |
| 10 | SEC-04 | screenRegistry freeze 처리 | P2 |
| 11 | QA-03 | 최대 탭 제한 테스트 추가 | P2 |
| 12 | QA-04 | 반응형 E2E 테스트 추가 | P2 |
| 13 | QA-05, QA-06, QA-07, ARCH-05 | 문서 보완 및 개선 권장 | P3~P5 |

---

## 6. 결론

TSK-02-05 MDI 컨텐츠 영역 설계는 **전반적으로 잘 구성**되어 있으며, MDI 패턴의 핵심 요구사항(상태 유지, 동적 로딩)을 적절히 반영하고 있습니다.

그러나 다음 영역에서 **구현 전 보완이 필요**합니다:
1. **에러 격리**: 탭별 ErrorBoundary 배치로 장애 격리
2. **메모리 관리**: 대량 탭 운영 시 리소스 관리 전략
3. **보안**: 화면 레벨 권한 검사 및 민감 정보 보호
4. **테스트**: 에러 케이스 및 스크롤 동작 테스트 보완

P1 이슈들을 설계 단계에서 해결 후 구현에 착수할 것을 권장합니다.

---

---

## 7. 적용 결과

> 적용일: 2026-01-20

### 7.1 적용 판단 요약

| 판단 | 건수 | 비율 |
|------|------|------|
| ✅ 적용 | 9건 | 69% |
| 📝 조정 적용 | 2건 | 15% |
| ⏸️ 보류 | 2건 | 15% |
| **합계** | **13건** | **100%** |

### 7.2 이슈별 적용 결과

| 이슈 ID | 우선순위 | 판단 | 적용 내용 / 보류 사유 |
|---------|----------|------|----------------------|
| ARCH-01 | P1 | ✅ 적용 | 탭별 ErrorBoundary 격리 구조로 에러 바운더리 다이어그램 전면 수정 |
| ARCH-02 | P1 | 📝 조정 적용 | 메모리 관리 전략 원칙만 명시 (BR-05 최대 탭 제한), LRU는 향후 확장 대상 |
| SEC-01 | P1 | ✅ 적용 | BR-06 화면 레벨 권한 검사 규칙 추가, loadScreen 코드 예시 포함 |
| SEC-02 | P1 | 📝 조정 적용 | 민감 화면 보호 정책(Level 1~3) 섹션 추가, 상세 구현은 구현 단계에서 |
| QA-01 | P1 | ✅ 적용 | TC-ERR-02, TC-ERR-03 상세 테스트 케이스 추가 |
| QA-02 | P1 | ✅ 적용 | TC-SCROLL-01, E2E-08 스크롤 동작 테스트 추가 |
| ARCH-03 | P2 | ⏸️ 보류 | ScreenLoader 책임 분리는 현재 설계 범위에서 충분, 구현 시 리팩토링 검토 |
| ARCH-04 | P2 | ⏸️ 보류 | screenRegistry 확장성은 현재 수동 매핑으로 충분, 화면 증가 시 재검토 |
| SEC-03 | P2 | ✅ 적용 | validateScreenPath 유틸리티 코드 예시 추가 |
| SEC-04 | P2 | ✅ 적용 | Object.freeze(screenRegistry) 적용, BR-07 규칙 추가 |
| QA-03 | P2 | ✅ 적용 | BR-05, TC-BR-05, E2E-06 최대 탭 제한 테스트 추가 |
| QA-04 | P2 | ✅ 적용 | E2E-07 반응형 E2E 테스트 추가 |
| QA-05 | P3 | ✅ 적용 | 컴포넌트별 책임 테이블 추가 |
| QA-06 | P3 | ✅ 적용 | 에러 메시지 통일: "요청하신 화면에 접근할 수 없습니다" |
| QA-07 | P4 | ✅ 적용 | data-testid 네이밍 규칙 `mdi-{component}-{variant}` 표준화 |
| ARCH-05 | P5 | ⏸️ 보류 | 인터페이스 명시화는 구현 단계에서 필요 시 적용 |

### 7.3 수정된 문서

| 문서 | 수정 내용 |
|------|----------|
| 010-design.md | BR-05~07 추가, 에러 바운더리 탭별 격리, 민감 화면 보호 정책, 경로 검증 유틸리티, 컴포넌트별 책임 테이블, 에러 메시지 통일 |
| 025-traceability-matrix.md | BR-05~07 매핑, 보안/스크롤/레이아웃 추적 섹션 추가, 커버리지 업데이트 |
| 026-test-specification.md | TC-ERR-02/03, TC-SCROLL-01, TC-BR-05~07, TC-SEC-01, E2E-06~08 추가, data-testid 네이밍 표준화 |

---

## 변경 이력

| 버전 | 일자 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0 | 2026-01-20 | Claude | 최초 작성 |
| 1.1 | 2026-01-20 | Claude | 적용 결과 섹션 추가 |
