# TSK-03-02 설계 리뷰 결과 (claude-1)

## 문서 정보

| 항목 | 내용 |
|------|------|
| Task ID | TSK-03-02 |
| Task명 | 역할-메뉴 매핑 |
| 리뷰어 | claude-1 |
| 리뷰 일자 | 2026-01-20 |
| 설계 문서 버전 | 1.1 |

---

## 검증 대상 문서

| 문서 | 상태 |
|------|------|
| 010-design.md | ✅ |
| 025-traceability-matrix.md | ✅ |
| 026-test-specification.md | ✅ |

---

## 리뷰 요약

### 검증 영역별 평가

| 검증 영역 | 평가 | 비고 |
|-----------|------|------|
| 문서 완전성 | PASS | 필수 섹션 모두 포함, 11개 섹션 체계적 구조화 |
| 요구사항 추적성 | PASS | FR 3건, BR 5건 100% 매핑 완료 |
| 아키텍처 | PASS | SOLID 원칙 준수, 컴포넌트 분할 적절 |
| 보안 | WARN | ADMIN Role ID 하드코딩, JWT 토큰 권한 동기화 이슈 |
| 테스트 가능성 | PASS | UT 7건, E2E 4건, TC 5건 정의, data-testid 완비 |
| 문서 일관성 | WARN | 추적성 매트릭스 섹션 참조 불일치 |

### 이슈 분포

| 우선순위 | 건수 |
|----------|------|
| P1 (Critical) | 0 |
| P2 (High) | 3 |
| P3 (Medium) | 5 |
| P4 (Low) | 6 |
| P5 (Info) | 2 |
| **합계** | **16** |

---

## 발견된 이슈

### P2 (High) - 구현 초기 수정 필요

| # | 영역 | 이슈 설명 | 권장 조치 |
|---|------|----------|----------|
| 1 | 데이터 모델 | TRD 2.3절 RoleMenu 스키마에 `onDelete: Cascade` 옵션 누락됨. 설계 문서와 TRD 간 불일치 | TRD 문서에 `onDelete: Cascade` 옵션 추가하여 문서 동기화 |
| 2 | 권한 상승 | SYSTEM_ADMIN_ROLE_ID = 1 하드코딩으로 시드 데이터 순서 변경 시 잘못된 역할에 관리자 권한 부여 가능 | 환경 변수 또는 설정 파일로 분리, Role 테이블에 `isSystemAdmin` Boolean 플래그 추가 권장 |
| 3 | 세션 보안 | JWT 토큰에 `allowedPaths` 캐싱 시 런타임 권한 변경이 토큰 만료 전까지 반영되지 않음 | 토큰 갱신 주기 단축 또는 권한 변경 시 강제 재로그인 메커니즘 도입 |

### P3 (Medium) - 구현 중 수정

| # | 영역 | 이슈 설명 | 권장 조치 |
|---|------|----------|----------|
| 4 | 비즈니스 규칙 | BR-03에서 ADMIN 식별 방법으로 Role.id 기반과 isSystemAdmin 플래그 두 가지를 언급하나, TRD 스키마에는 isSystemAdmin 필드가 정의되지 않음 | Role 모델에 isSystemAdmin Boolean 필드 추가 또는 BR-03에서 Role.id 기반 방식만 사용하도록 명확화 |
| 5 | 세션 관리 | 세션 만료 시간, 동시 로그인 정책, 세션 무효화 전략에 대한 명시적 정의 부재 | 세션 타임아웃(예: 30분), 최대 동시 세션 수, 강제 로그아웃 API 정의 추가 |
| 6 | 추적성 매트릭스 | FR-001의 설계 문서 섹션 참조가 "섹션 5.1"로 되어 있으나 실제 메뉴 API 필터링 로직은 섹션 6.1에 있음 | 추적성 매트릭스의 설계 문서 섹션 참조를 정확하게 수정 |
| 7 | 인가 검증 | 예약된 역할 코드(ADMIN, SYSTEM, ROOT 등) 생성 방지 검증 로직의 구체적 구현 미정의 | Role 생성 API에 예약어 검증 로직 추가 명세 |
| 8 | 테스트 명세서 | E2E-003 "MANAGER 로그인 후 메뉴 확인" 테스트에서 품질 관리(QUALITY), 설비 관리(EQUIPMENT) 메뉴 검증 누락 | E2E-003 검증 포인트에 QUALITY, EQUIPMENT 메뉴 확인 추가 |

### P4 (Low) - 구현 후 검토

| # | 영역 | 이슈 설명 | 권장 조치 |
|---|------|----------|----------|
| 9 | 문서화 | 설계 문서 섹션 4.3 권한 매트릭스에서 "품질 관리", "설비 관리" 메뉴가 언급되나 시드 데이터에 해당 메뉴 코드 미정의 | 시드 데이터에 QUALITY, EQUIPMENT 메뉴 코드 추가 |
| 10 | 테스트 | UC-02(권한 없는 메뉴 접근 차단)에 대한 E2E 자동화 테스트 부재 | TC-004 매뉴얼 테스트를 E2E 자동화 테스트로 전환 권장 |
| 11 | 감사 로그 | 권한 변경, 메뉴 접근, 로그인/로그아웃에 대한 감사 로그(Audit Log) 설계 부재 | 민감한 작업에 대한 감사 로그 테이블 및 로깅 전략 추가 |
| 12 | 테스트 명세서 | TC-005 "메뉴 정렬 순서" 매뉴얼 테스트 상세 절차 누락 | TC-005 매뉴얼 테스트 상세 절차 추가 |
| 13 | 추적성 매트릭스 | 인터페이스 추적에서 GET /api/menus의 구현 Task(TSK-03-03) 명시 부재 | 인터페이스 추적 테이블에 "구현 Task" 컬럼 추가 |
| 14 | 테스트 명세서 | 단위 테스트 UT-002 "MANAGER 역할 메뉴 조회" 상세에 테스트 코드 스켈레톤 누락 | UT-002에 테스트 코드 스켈레톤 추가 |

### P5 (Info) - 참고 사항

| # | 영역 | 이슈 설명 | 권장 조치 |
|---|------|----------|----------|
| 15 | 설계 문서 | 체크리스트 11.2에서 추적성 매트릭스와 테스트 명세서 작성 상태가 미완료로 표시 | 체크리스트 상태를 [x]로 업데이트 |
| 16 | 추적성 매트릭스 | FR-002의 설계 문서 섹션 참조에 섹션 6.1(buildMenuTreeWithInheritance) 참조 누락 | 추적성 매트릭스 FR-002에 섹션 6.1 참조 추가 |

---

## 긍정적 평가 사항

### 아키텍처 설계

- **SOLID 원칙 준수**: RoleMenu 테이블이 역할-메뉴 매핑이라는 단일 책임만 담당. 새로운 역할/메뉴 추가 시 기존 코드 수정 없이 매핑만 추가
- **데이터 모델 정규화**: Role-Menu 다대다 관계를 연결 테이블로 정규화, `@@unique([roleId, menuId])` 복합 유니크 제약으로 중복 방지
- **확장성 고려**: BR-02(자식 → 부모 자동 표시) 규칙으로 계층 구조 확장에 유연하게 대응, 자기 참조 관계로 무한 계층 메뉴 지원

### 보안 설계

- **Defense in Depth**: 클라이언트 UI 숨김, 서버 사이드 미들웨어, API 레벨 권한 검증의 3중 방어 계층 설계
- **OWASP 주요 취약점 대응**: Prisma ORM을 통한 SQL Injection 방지, React 자동 이스케이프를 통한 XSS 방지
- **문자열 비교 회피**: ADMIN 역할 검증 시 문자열 비교 대신 ID 기반 검증으로 대소문자 변형 공격 방지

### 문서 품질

- **체계적인 문서 구조**: 설계 문서가 11개 섹션으로 잘 구조화, 유즈케이스 다이어그램/ER 다이어그램/권한 매트릭스 등 시각적 문서화 충실
- **상세한 유즈케이스 정의**: UC-01, UC-02가 기본 흐름, 대안 흐름, 예외 흐름까지 상세히 기술
- **PRD/TRD 연계**: 참조 문서 섹션에서 PRD 4.1.1, TRD 2.3 등 구체적인 섹션까지 명시

### 테스트 설계

- **추적성 매트릭스 완성도**: FR/BR 모두 100% 매핑 완료, 역추적 매트릭스(테스트 → 요구사항)도 포함
- **테스트 데이터 체계화**: Mock 데이터, 시드 데이터, 테스트 계정이 체계적으로 정의
- **data-testid 사전 정의**: 사이드바, 로그인 페이지, 에러 페이지에 대한 data-testid가 명확히 정의

---

## 리뷰어 의견

TSK-03-02 역할-메뉴 매핑 설계는 전반적으로 **우수한 품질**로 작성되었습니다.

**주요 강점:**
- RBAC 설계가 명확하고 보안 측면에서 3중 방어 계층을 적용
- 비즈니스 규칙 5개가 코드 예시와 함께 명확하게 정의
- PRD/TRD → 설계 → 테스트 간 추적성이 잘 확보됨

**개선 필요 사항:**
- P2 이슈 3건(TRD 동기화, ADMIN Role ID 하드코딩, JWT 토큰 권한 동기화)은 구현 전 검토 권장
- P3~P4 이슈는 구현 과정에서 순차적으로 보완 가능

**결론:** 현재 설계로 구현 진행 가능하나, P2 이슈 3건에 대한 대응 방안을 명확히 하고 진행하는 것을 권장합니다.

---

## 변경 이력

| 버전 | 일자 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0 | 2026-01-20 | claude-1 | 최초 작성 (아키텍처/보안/품질 3개 관점 통합 리뷰) |
