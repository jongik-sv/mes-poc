# 요구사항 추적성 매트릭스 (025-traceability-matrix.md)

**Template Version:** 1.0.0 — **Last Updated:** 2026-01-20

> **목적**: PRD → 기본설계 → 상세설계 → 테스트 4단계 양방향 추적
>
> **참조**: 이 문서는 `010-design.md`와 `026-test-specification.md`와 함께 사용됩니다.

---

## 0. 문서 메타데이터

| 항목 | 내용 |
|------|------|
| Task ID | TSK-03-02 |
| Task명 | 역할-메뉴 매핑 |
| 설계 문서 참조 | `010-design.md` |
| 테스트 명세 참조 | `026-test-specification.md` |
| 작성일 | 2026-01-20 |
| 작성자 | Claude |

---

## 1. 기능 요구사항 추적 (FR → 설계 → 테스트)

> PRD → 기본설계 → 상세설계 → 테스트케이스 매핑

| 요구사항 ID | PRD 섹션 | 설계 문서 섹션 | 단위 테스트 | E2E 테스트 | 매뉴얼 TC | 상태 |
|-------------|----------|---------------|-------------|------------|-----------|------|
| FR-001 | 4.1.1 동적 메뉴 - 사용자 권한별 메뉴 필터링 | 010-design.md 섹션 5.1 | UT-001, UT-002 | E2E-001 | TC-001 | 설계완료 |
| FR-002 | 4.1.1 동적 메뉴 - 계층형 메뉴 지원 | 010-design.md 섹션 5.2 | UT-003 | E2E-002 | TC-002 | 설계완료 |
| FR-003 | 4.1.1 동적 메뉴 - 메뉴 순서 관리 | 010-design.md 섹션 4.2 | UT-004 | E2E-001 | TC-001 | 설계완료 |

### 1.1 요구사항별 상세 매핑

#### FR-001: 사용자 권한별 메뉴 필터링

| 설계 단계 | 문서 | 섹션 | 구현 항목 |
|----------|------|------|----------|
| PRD | prd.md | 4.1.1 | 사용자 권한별 메뉴 필터링 |
| 설계 | 010-design.md | 5.1 | 메뉴 조회 API 필터링 로직 |
| 설계 | 010-design.md | 6.1 | BR-01: 역할 기반 메뉴 필터링 |
| 단위 테스트 | 026-test-specification.md | 2.1 | UT-001, UT-002 |
| E2E 테스트 | 026-test-specification.md | 3.1 | E2E-001 |

#### FR-002: 계층형 메뉴 구조 지원

| 설계 단계 | 문서 | 섹션 | 구현 항목 |
|----------|------|------|----------|
| PRD | prd.md | 4.1.1 | 계층형 트리 메뉴 (최대 3단계) |
| 설계 | 010-design.md | 5.2 | BR-02: 자식 → 부모 자동 표시 |
| 설계 | 010-design.md | 6.1 | buildMenuTreeWithInheritance 로직 |
| 단위 테스트 | 026-test-specification.md | 2.1 | UT-003 |
| E2E 테스트 | 026-test-specification.md | 3.1 | E2E-002 |

#### FR-003: 메뉴 순서 관리

| 설계 단계 | 문서 | 섹션 | 구현 항목 |
|----------|------|------|----------|
| PRD | prd.md | 4.1.1 | 메뉴 순서 관리 |
| 설계 | 010-design.md | 4.2 | Menu.sortOrder 필드 |
| 설계 | 010-design.md | 6.1 | orderBy: sortOrder 정렬 |
| 단위 테스트 | 026-test-specification.md | 2.1 | UT-004 |
| E2E 테스트 | 026-test-specification.md | 3.1 | E2E-001 |

---

## 2. 비즈니스 규칙 추적 (BR → 구현 → 검증)

| 규칙 ID | PRD 출처 | 설계 문서 섹션 | 구현 위치(개념) | 단위 테스트 | E2E 테스트 | 검증 방법 | 상태 |
|---------|----------|--------------|-----------------|-------------|------------|-----------|------|
| BR-01 | 4.1.1 권한별 메뉴 필터링 | 010-design.md 5.1 | 메뉴 API | UT-001, UT-002 | E2E-001, E2E-003 | 역할별 반환 메뉴 목록 검증 | 설계완료 |
| BR-02 | 4.1.1 계층형 메뉴 | 010-design.md 5.2 | 메뉴 트리 빌더 | UT-003 | E2E-002 | 자식 권한 시 부모 표시 확인 | 설계완료 |
| BR-03 | TRD 2.3 | 010-design.md 5.2 | 권한 검사 | UT-005 | E2E-004 | ADMIN 역할 전체 메뉴 접근 확인 | 설계완료 |
| BR-04 | TRD 2.3 | 010-design.md 4.1 | Prisma 스키마 | UT-006 | - | Unique 제약조건 동작 확인 | 설계완료 |
| BR-05 | TRD 2.3 | 010-design.md 4.1 | Prisma 스키마 | UT-007 | - | Cascade 삭제 동작 확인 | 설계완료 |

### 2.1 비즈니스 규칙별 상세 매핑

#### BR-01: 역할 기반 메뉴 필터링

| 구분 | 내용 |
|------|------|
| **PRD 원문** | 사용자 권한별 메뉴 필터링 |
| **설계 표현** | RoleMenu 테이블 조회를 통한 메뉴 ID 필터링 |
| **구현 위치** | GET /api/menus API 핸들러 |
| **검증 방법** | 역할별로 다른 메뉴 목록이 반환되는지 확인 |
| **관련 테스트** | UT-001, UT-002, E2E-001, E2E-003 |

#### BR-02: 계층형 메뉴 필터링 (자식 → 부모 자동 표시)

| 구분 | 내용 |
|------|------|
| **PRD 원문** | 계층형 트리 메뉴 지원 (최대 3단계) |
| **설계 표현** | 자식 메뉴 권한이 있으면 부모 메뉴도 자동으로 표시 |
| **구현 위치** | buildMenuTreeWithInheritance 유틸리티 함수 |
| **검증 방법** | 자식만 권한 있을 때 부모 폴더가 표시되는지 확인 |
| **관련 테스트** | UT-003, E2E-002 |

#### BR-03: ADMIN 역할 전체 메뉴 접근

| 구분 | 내용 |
|------|------|
| **PRD 원문** | - (TRD에서 정의) |
| **설계 표현** | ADMIN 역할은 RoleMenu 매핑과 관계없이 모든 활성 메뉴 접근 |
| **구현 위치** | isSystemAdmin 검사 로직 |
| **검증 방법** | ADMIN 역할 사용자가 모든 메뉴에 접근 가능한지 확인 |
| **관련 테스트** | UT-005, E2E-004 |

#### BR-04: 중복 매핑 방지

| 구분 | 내용 |
|------|------|
| **PRD 원문** | - (TRD에서 정의) |
| **설계 표현** | (roleId, menuId) 조합에 대한 Unique 제약조건 |
| **구현 위치** | Prisma 스키마 @@unique([roleId, menuId]) |
| **검증 방법** | 동일 조합 중복 생성 시 에러 발생 확인 |
| **관련 테스트** | UT-006 |

#### BR-05: Cascade 삭제

| 구분 | 내용 |
|------|------|
| **PRD 원문** | - (TRD에서 정의) |
| **설계 표현** | Role/Menu 삭제 시 관련 RoleMenu 매핑 자동 삭제 |
| **구현 위치** | Prisma 스키마 onDelete: Cascade |
| **검증 방법** | Role/Menu 삭제 후 RoleMenu 레코드도 삭제되는지 확인 |
| **관련 테스트** | UT-007 |

---

## 3. 테스트 역추적 매트릭스

> 테스트 결과 → 요구사항 역추적용 (build/verify 단계 결과서 생성 시 활용)

| 테스트 ID | 테스트 유형 | 검증 대상 요구사항 | 검증 대상 비즈니스 규칙 | 상태 |
|-----------|------------|-------------------|----------------------|------|
| UT-001 | 단위 | FR-001 | BR-01 | 미실행 |
| UT-002 | 단위 | FR-001 | BR-01 | 미실행 |
| UT-003 | 단위 | FR-002 | BR-02 | 미실행 |
| UT-004 | 단위 | FR-003 | - | 미실행 |
| UT-005 | 단위 | - | BR-03 | 미실행 |
| UT-006 | 단위 | - | BR-04 | 미실행 |
| UT-007 | 단위 | - | BR-05 | 미실행 |
| E2E-001 | E2E | FR-001, FR-003 | BR-01 | 미실행 |
| E2E-002 | E2E | FR-002 | BR-02 | 미실행 |
| E2E-003 | E2E | FR-001 | BR-01 | 미실행 |
| E2E-004 | E2E | - | BR-03 | 미실행 |
| TC-001 | 매뉴얼 | FR-001, FR-003 | BR-01 | 미실행 |
| TC-002 | 매뉴얼 | FR-002 | BR-02 | 미실행 |
| TC-003 | 매뉴얼 | - | BR-03 | 미실행 |

---

## 4. 데이터 모델 추적

> 설계 엔티티 → Prisma 모델 → API DTO 매핑

| 설계 엔티티 | Prisma 모델 | API Request DTO | API Response DTO |
|------------|-------------|-----------------|------------------|
| RoleMenu | RoleMenu | CreateRoleMenuDto | - |
| Role | Role (TSK-04-02) | - | RoleDto |
| Menu | Menu (TSK-03-01) | - | MenuItemDto |

### 4.1 DTO 정의

```typescript
// CreateRoleMenuDto - 역할-메뉴 매핑 생성용
interface CreateRoleMenuDto {
  roleId: number
  menuId: number
}

// MenuItemDto - 메뉴 응답용
interface MenuItemDto {
  id: number
  code: string
  name: string
  path: string | null
  icon: string | null
  children?: MenuItemDto[]
}

// MenuResponse - 메뉴 목록 API 응답
interface MenuResponse {
  success: true
  data: MenuItemDto[]
}
```

---

## 5. 인터페이스 추적

> 설계 인터페이스 요구사항 → API 엔드포인트 매핑

| 설계 인터페이스 | API 엔드포인트 | Method | Path | 요구사항 |
|----------------|---------------|--------|------|----------|
| 메뉴 조회 (권한 필터링) | 메뉴 목록 API | GET | /api/menus | FR-001, FR-002, FR-003 |
| 역할-메뉴 매핑 조회 | 역할별 메뉴 조회 | GET | /api/roles/{roleId}/menus | - (관리 기능) |
| 역할-메뉴 매핑 생성 | 매핑 생성 | POST | /api/role-menus | - (관리 기능) |
| 역할-메뉴 매핑 삭제 | 매핑 삭제 | DELETE | /api/role-menus/{id} | - (관리 기능) |

> **참고**: GET /api/menus는 TSK-03-03에서 구현, 역할-메뉴 관리 API는 MVP 이후 관리자 화면에서 필요 시 구현

---

## 6. 화면 추적

> 설계 화면 요구사항 → 컴포넌트 매핑

| 설계 화면 | 컴포넌트 | 요구사항 |
|----------|----------|----------|
| 사이드바 메뉴 | Sidebar.tsx (TSK-01-03) | FR-001, FR-002 |
| 권한 없음 페이지 | 403.tsx | UC-02 예외 흐름 |

> **참고**: 역할-메뉴 관리 화면은 MVP 범위 외, 향후 시스템 관리 > 권한 관리 화면에서 구현

---

## 7. 추적성 검증 요약

### 7.1 커버리지 통계

| 구분 | 총 항목 | 매핑 완료 | 미매핑 | 커버리지 |
|------|---------|----------|--------|---------|
| 기능 요구사항 (FR) | 3 | 3 | 0 | 100% |
| 비즈니스 규칙 (BR) | 5 | 5 | 0 | 100% |
| 단위 테스트 (UT) | 7 | 7 | 0 | 100% |
| E2E 테스트 | 4 | 4 | 0 | 100% |
| 매뉴얼 테스트 (TC) | 3 | 3 | 0 | 100% |

### 7.2 미매핑 항목 (있는 경우)

| 구분 | ID | 설명 | 미매핑 사유 |
|------|-----|------|-----------|
| - | - | - | - |

---

## 관련 문서

- 설계 문서: `010-design.md`
- 테스트 명세: `026-test-specification.md`
- PRD: `.orchay/projects/mes-portal/prd.md`
- TRD: `.orchay/projects/mes-portal/trd.md`

---

## 변경 이력

| 버전 | 일자 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0 | 2026-01-20 | Claude | 최초 작성 |
