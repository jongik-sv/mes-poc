# 설계 리뷰 보고서 - TSK-06-03 입력/수정 폼 템플릿

**Template Version:** 1.0.0 — **Last Updated:** 2026-01-21

---

## 문서 정보

| 항목 | 내용 |
|------|------|
| Task ID | TSK-06-03 |
| Task명 | 입력/수정 폼 템플릿 |
| 리뷰어 | claude-1 |
| 리뷰 일자 | 2026-01-21 |
| 검토 문서 | 010-design.md, 025-traceability-matrix.md, 026-test-specification.md |
| 참조 문서 | prd.md (4.1.1), trd.md (7. 폼/입력) |

---

## 1. 리뷰 요약

### 1.1 검증 대상 확인

| 문서 | 상태 | 비고 |
|------|------|------|
| 010-design.md | ✅ 확인 | 통합설계 문서 (976줄) |
| 025-traceability-matrix.md | ✅ 확인 | 추적성 매트릭스 |
| 026-test-specification.md | ✅ 확인 | 테스트 명세서 |

### 1.2 검증 결과 요약

| 검증 영역 | 평가 | 비고 |
|----------|------|------|
| 문서 완전성 | PASS | 필수 섹션 모두 포함 |
| 요구사항 추적성 | WARN | 문서 간 수량 불일치 |
| 아키텍처 | WARN | 1건 High, 2건 Medium |
| 보안 | FAIL | 1건 Critical, 2건 High |
| 테스트 가능성 | WARN | data-testid 1건 누락 |

### 1.3 이슈 분포

```
심각도별 분포:
- Critical: 1건 (보안)
- High: 4건 (아키텍처 1, 보안 2, 품질 1)
- Medium: 9건 (아키텍처 2, 보안 2, 품질 5)
- Low: 2건 (보안 1, 품질 1)
- Info: 2건 (아키텍처 1, 품질 1)

총 이슈: 18건
```

---

## 2. 아키텍처 리뷰 결과

### 이슈 #A-01: useFormDirty 훅의 제네릭 타입 바운드 부재

| 항목 | 내용 |
|------|------|
| 검증 영역 | 아키텍처 |
| 심각도 | High |
| 우선순위 | P2 |
| 설계 섹션 | 13.2 주요 Hook |

**현재 설계:**
```typescript
interface UseFormDirtyReturn<T> {
  isDirty: boolean;
  dirtyFields: (keyof T)[];
  resetDirty: () => void;
  checkDirty: (field: keyof T, value: unknown) => boolean;
}
```

**문제점:**
- 제네릭 타입 `T`에 대한 제약(constraint)이 없어 어떤 타입이든 허용됨
- `value: unknown` 타입으로 인해 타입 안전성이 저하됨
- 초기값(initialValues)과의 비교 로직을 위한 인터페이스가 명시되지 않음
- Ant Design Form의 `FieldData` 타입과의 통합 방안이 불명확함

**개선 제안:**
```typescript
interface UseFormDirtyOptions<T extends Record<string, unknown>> {
  form: FormInstance<T>;
  initialValues: Partial<T>;
  deepCompare?: boolean;
}

interface UseFormDirtyReturn<T extends Record<string, unknown>> {
  isDirty: boolean;
  dirtyFields: Set<keyof T>;
  getDirtyValue: <K extends keyof T>(field: K) => { original: T[K]; current: T[K] } | null;
  resetDirty: () => void;
}
```

**영향 범위:** hooks/useFormDirty.ts, FormTemplate.tsx, 모든 폼 사용 화면

---

### 이슈 #A-02: FormTemplate의 단일 책임 원칙(SRP) 위반 가능성

| 항목 | 내용 |
|------|------|
| 검증 영역 | 아키텍처 |
| 심각도 | Medium |
| 우선순위 | P3 |
| 설계 섹션 | 7.2, 13.1 |

**현재 설계:**
- FormTemplate이 28개의 Props를 가지며, 폼 설정/액션/상태/변경감지/헤더/기타 등 6개 그룹의 책임을 담당
- 하나의 컴포넌트가 레이아웃, 유효성 검사, 변경 감지, 이탈 경고, 라우팅까지 처리

**문제점:**
- Props가 과도하게 많아 컴포넌트의 복잡도가 높음
- 변경 감지, 이탈 경고, 라우팅 기능이 폼 렌더링과 결합
- 향후 기능 추가 시(예: 자동 저장) Props가 더 증가할 가능성

**개선 제안:**
Compound Component 패턴 적용:
```tsx
<FormTemplate form={form} onSubmit={handleSubmit}>
  <FormTemplate.Header title="작업 지시" mode="create" />
  <FormTemplate.Body enableDirtyCheck showDirtyIndicator>
    {/* Form.Item들 */}
  </FormTemplate.Body>
  <FormTemplate.Footer showSubmit showCancel onCancel={handleCancel} />
  <FormTemplate.LeaveGuard enabled message="저장하지 않은 변경사항이 있습니다." />
</FormTemplate>
```

**영향 범위:** FormTemplate 전체 구조, 사용처 API

---

### 이슈 #A-03: 브라우저 이탈 경고와 SPA 라우팅 이탈 경고 통합 부재

| 항목 | 내용 |
|------|------|
| 검증 영역 | 아키텍처 |
| 심각도 | Medium |
| 우선순위 | P3 |
| 설계 섹션 | 11.3, UC-07 |

**현재 설계:**
- "브라우저 이탈 경고" 제약 사항에서 "beforeunload 이벤트 제한 - 기본 브라우저 메시지 사용"으로 명시
- SPA 라우팅(Next.js App Router)에서의 이탈 경고 처리 방안이 구체화되지 않음

**문제점:**
- Next.js App Router는 기존 `router.events`가 없음
- 브라우저 beforeunload와 SPA 내부 라우팅이 각각 다른 메커니즘으로 동작
- MDI 탭 닫기 시의 이탈 경고 처리가 별도로 필요함

**개선 제안:**
```typescript
interface UseLeaveConfirmOptions {
  enabled: boolean;
  message?: string;
  enableBeforeUnload?: boolean;
  enableRouteChangeWarning?: boolean;
  onTabCloseAttempt?: () => boolean;
}
```

**영향 범위:** useLeaveConfirm.ts, MDI 탭 컴포넌트, 전역 라우팅 레이어

---

### 이슈 #A-04: Ant Design Form과의 중복 상태 관리 우려

| 항목 | 내용 |
|------|------|
| 검증 영역 | 아키텍처 |
| 심각도 | Info |
| 우선순위 | P4 |
| 설계 섹션 | 7.2, 13.3 |

**현재 설계:**
- `loading` 상태를 Props로 받음
- `form` 인스턴스를 외부에서 주입하거나 내부에서 생성
- 초기값 설정이 두 경로로 가능

**개선 제안:**
- Form 인스턴스 관리 정책 명확화: "외부 주입 우선, 미제공 시 내부 생성"
- loading 상태는 "API 호출 중" 상태임을 명시
- 문서에 상태 흐름도 추가

**영향 범위:** FormTemplate.tsx 내부 구현, 사용 가이드 문서

---

## 3. 보안 리뷰 결과

### 이슈 #S-01: 서버 사이드 유효성 검사 미언급

| 항목 | 내용 |
|------|------|
| 검증 영역 | 보안 |
| 심각도 | **Critical** |
| 우선순위 | **P1** |
| OWASP 관련 | A03:2021 - Injection, A04:2021 - Insecure Design |

**현재 설계:**
- 섹션 6.3에서 유효성 검사 타이밍을 `blur`, `change`, `submit`으로 정의하고 있으며, 모두 클라이언트 사이드에서만 수행됨

**위험:**
- 클라이언트 사이드 유효성 검사는 브라우저 개발자 도구, Proxy 도구로 쉽게 우회 가능
- 악의적 사용자가 XSS 페이로드, SQL Injection, 악성 데이터를 직접 API로 전송 가능
- 데이터 무결성 및 시스템 보안 위협

**권장 조치:**
1. 설계 문서에 "서버 사이드 유효성 검사 필수" 원칙 명시
2. 클라이언트 검사는 UX 개선용이며, 서버에서 동일한 규칙으로 재검증 필수임을 명시
3. API 레이어 설계에서 동일한 유효성 규칙 적용 요구사항 추가

---

### 이슈 #S-02: XSS(Cross-Site Scripting) 방어 전략 미정의

| 항목 | 내용 |
|------|------|
| 검증 영역 | 보안 |
| 심각도 | High |
| 우선순위 | P1 |
| OWASP 관련 | A03:2021 - Injection (XSS) |

**현재 설계:**
- 섹션 7.3에서 `pattern` 정규식 검증을 언급하지만, XSS 공격 문자열 필터링에 대한 언급 없음
- 저장된 데이터가 다른 화면에서 렌더링될 때의 출력 인코딩 전략도 미정의

**위험:**
- 사용자 입력값에 악성 스크립트 삽입 가능
- 저장된 XSS(Stored XSS)로 인해 다른 사용자의 세션 탈취, 데이터 유출 가능

**권장 조치:**
1. 입력 시 위험 문자 필터링/이스케이프 전략 정의
2. React의 기본 XSS 방어 활용 및 `dangerouslySetInnerHTML` 사용 금지 원칙 추가
3. Content Security Policy(CSP) 헤더 적용 권장

---

### 이슈 #S-03: CSRF(Cross-Site Request Forgery) 방어 미언급

| 항목 | 내용 |
|------|------|
| 검증 영역 | 보안 |
| 심각도 | High |
| 우선순위 | P2 |
| OWASP 관련 | A01:2021 - Broken Access Control |

**현재 설계:**
- 섹션 3.2 UC-03 저장 유즈케이스에서 "API를 호출한다"만 명시
- CSRF 토큰 검증이나 SameSite 쿠키 설정에 대한 언급 없음

**위험:**
- 악성 웹사이트에서 사용자 모르게 폼 데이터 제출 유도 가능
- 인증된 사용자의 권한으로 데이터 생성/수정/삭제 가능

**권장 조치:**
1. API 호출 시 CSRF 토큰 포함 원칙 명시
2. SameSite=Strict 또는 Lax 쿠키 설정 권장
3. 중요 작업에 대한 재인증 고려

---

### 이슈 #S-04: 에러 메시지 정보 노출 위험

| 항목 | 내용 |
|------|------|
| 검증 영역 | 보안 |
| 심각도 | Medium |
| 우선순위 | P3 |
| OWASP 관련 | A05:2021 - Security Misconfiguration |

**현재 설계:**
- 섹션 9.1에서 "중복 데이터 - 이미 존재하는 항목입니다" 등 상세 에러 메시지 정의

**위험:**
- 상세한 에러 메시지로 시스템 내부 구조 노출 가능
- "이미 존재하는 항목" 메시지로 유효한 데이터 열거(Enumeration) 공격 가능

**권장 조치:**
1. 사용자 표시 메시지와 내부 로그 메시지 분리 원칙 명시
2. 중복 검사 시 모호한 메시지 사용 고려 ("입력값을 확인해주세요")
3. 개발/운영 환경별 에러 표시 수준 차별화

---

### 이슈 #S-05: 민감 데이터 처리 지침 부재

| 항목 | 내용 |
|------|------|
| 검증 영역 | 보안 |
| 심각도 | Medium |
| 우선순위 | P3 |
| OWASP 관련 | A02:2021 - Cryptographic Failures |

**현재 설계:**
- 섹션 7.2 Props에서 일반적인 폼 데이터 처리만 정의
- 비밀번호, 개인정보 등 민감 데이터 처리 시 보안 고려사항 미언급

**권장 조치:**
1. 민감 데이터 필드 타입 지침 추가 (Input.Password 사용 등)
2. 자동완성 비활성화 옵션 (`autoComplete="off"`) 지침
3. HTTPS 전송 필수 명시

---

### 이슈 #S-06: 세션 만료 처리 상세 미정의

| 항목 | 내용 |
|------|------|
| 검증 영역 | 보안 |
| 심각도 | Low |
| 우선순위 | P4 |
| OWASP 관련 | A07:2021 - Identification and Authentication Failures |

**현재 설계:**
- 섹션 9.1에서 "세션 만료 - 재로그인"으로 간략히 언급

**권장 조치:**
1. 저장 전 세션 유효성 사전 검증 로직 추가
2. 세션 만료 시 입력 데이터 임시 저장 후 재로그인 유도 방안
3. 토큰 자동 갱신 메커니즘 연계

---

## 4. 품질 리뷰 결과

### 이슈 #Q-01: 추적성 매트릭스의 단위 테스트 수량 불일치

| 항목 | 내용 |
|------|------|
| 검증 영역 | 일관성 |
| 심각도 | High |
| 우선순위 | P1 |
| 문서 | 025-traceability-matrix.md, 026-test-specification.md |

**현재 상태:**
- 추적성 매트릭스 7.1절: 단위 테스트 13개 (UT-001~UT-013)
- 테스트 명세서 2.1절: 단위 테스트 15개 (UT-001~UT-015)

**문제점:**
- 두 문서 간 단위 테스트 수량이 일치하지 않음
- UT-014, UT-015가 추적성 매트릭스에 누락

**개선 방안:**
- 추적성 매트릭스에 UT-014, UT-015 추가
- 7.1 커버리지 통계 수정 (단위 테스트: 13 -> 15)

---

### 이슈 #Q-02: 요구사항 ID와 테스트 명세서 매핑 불일치

| 항목 | 내용 |
|------|------|
| 검증 영역 | 추적성 |
| 심각도 | Medium |
| 우선순위 | P2 |

**현재 상태:**
- 추적성 매트릭스: FR-001~FR-004 (4개)
- 테스트 명세서: FR-001~FR-008 참조

**문제점:**
- 정의되지 않은 FR-005~FR-008을 테스트 명세서에서 참조

**개선 방안:**
- 추적성 매트릭스에 FR-005~FR-008 정의 추가
- 또는 테스트 명세서의 요구사항 ID 수정

---

### 이슈 #Q-03: PRD 요구사항 누락 - 폼 초기화/리셋 기능

| 항목 | 내용 |
|------|------|
| 검증 영역 | 추적성 |
| 심각도 | Medium |
| 우선순위 | P2 |

**현재 상태:**
- PRD 4.1.1: "폼 초기화/리셋 기능" 명시
- 추적성 매트릭스: 별도 FR로 추적되지 않음

**개선 방안:**
- FR-005 "폼 초기화/리셋"을 추가하고 UC-06과 매핑

---

### 이슈 #Q-04: data-testid 누락 - 폼 초기화 버튼

| 항목 | 내용 |
|------|------|
| 검증 영역 | 테스트가능성 |
| 심각도 | Medium |
| 우선순위 | P2 |

**현재 상태:**
- 설계 문서 와이어프레임: [초기화] 버튼 포함
- data-testid 목록: 초기화 버튼 누락

**개선 방안:**
- `form-reset-btn` data-testid 추가
- 초기화 버튼 관련 테스트 케이스 추가

---

### 이슈 #Q-05: E2E 테스트 수량 불일치

| 항목 | 내용 |
|------|------|
| 검증 영역 | 일관성 |
| 심각도 | Medium |
| 우선순위 | P2 |

**현재 상태:**
- 추적성 매트릭스: E2E 테스트 8개
- 테스트 명세서: E2E 테스트 10개

**개선 방안:**
- 추적성 매트릭스에 E2E-009, E2E-010 추가

---

### 이슈 #Q-06: 비즈니스 규칙 ID 불일치

| 항목 | 내용 |
|------|------|
| 검증 영역 | 일관성 |
| 심각도 | Low |
| 우선순위 | P3 |

**현재 상태:**
- 설계 문서: BR-01 ~ BR-06 (6개)
- 추적성 매트릭스: BR-001 ~ BR-004 (4개)

**개선 방안:**
- ID 형식 통일
- 누락된 BR-005, BR-006 추가

---

### 이슈 #Q-07: 매뉴얼 테스트 수량 불일치

| 항목 | 내용 |
|------|------|
| 검증 영역 | 일관성 |
| 심각도 | Low |
| 우선순위 | P3 |

**현재 상태:**
- 추적성 매트릭스: 4개
- 테스트 명세서: 12개

**개선 방안:**
- 추적성 매트릭스에 TC-005~TC-012 추가

---

### 이슈 #Q-08: 커버리지 통계 수치 업데이트 필요

| 항목 | 내용 |
|------|------|
| 검증 영역 | 문서완전성 |
| 심각도 | Info |
| 우선순위 | P4 |

**개선 방안:**
- 추적성 매트릭스 7.1 통계를 테스트 명세서와 일치시키도록 업데이트

---

## 5. 긍정적 평가

### 아키텍처 강점
- Ant Design과의 적절한 통합 설계 (TRD 원칙 준수)
- `useFormDirty`, `useLeaveConfirm` 훅 분리를 통한 관심사 분리
- 제네릭 타입으로 다양한 폼 데이터 타입 지원
- 명확한 컴포넌트 계층 구조 (FormHeader, FormBody, FormFooter)

### 품질 강점
- 설계 문서의 구조가 체계적이며 PRD 요구사항을 잘 반영
- 테스트 명세서에 다양한 경계 조건 및 엣지 케이스 정의
- 유효성 검사 규칙이 PRD 요구사항 모두 포함
- 변경 감지 및 이탈 경고 기능 상세 설계

---

## 6. 권장 후속 조치

### 6.1 필수 조치 (구현 전)

| 우선순위 | 이슈 ID | 내용 | 담당 단계 |
|---------|---------|------|----------|
| P1 | S-01 | 서버 사이드 유효성 검사 원칙 명시 | 설계 보완 |
| P1 | S-02 | XSS 방어 전략 정의 | 설계 보완 |
| P1 | Q-01 | 테스트 수량 동기화 | 문서 수정 |

### 6.2 권장 조치 (상세설계 또는 구현 시)

| 우선순위 | 이슈 ID | 내용 | 담당 단계 |
|---------|---------|------|----------|
| P2 | A-01 | 제네릭 타입 바운드 확정 | 상세 설계 |
| P2 | S-03 | CSRF 방어 명시 | 설계 보완 |
| P2 | Q-02~Q-05 | 추적성 매트릭스 동기화 | 문서 수정 |

### 6.3 참고 조치 (향후 개선)

| 우선순위 | 이슈 ID | 내용 | 담당 단계 |
|---------|---------|------|----------|
| P3 | A-02, A-03 | SRP 개선, 이탈 경고 통합 | 상세 설계 |
| P3 | S-04, S-05 | 에러 메시지, 민감 데이터 지침 | 설계 보완 |
| P4 | A-04 | 상태 흐름도 추가 | 문서화 |
| P4 | S-06 | 세션 만료 처리 상세화 | 설계 보완 |

---

## 7. 결론

TSK-06-03 입력/수정 폼 템플릿 설계 문서는 전반적으로 PRD/TRD 요구사항을 잘 반영하고 있으며, Ant Design과의 통합 전략이 적절합니다. 그러나 **보안 관점에서 Critical 이슈(서버 사이드 유효성 검사 미언급)**가 발견되어 구현 전 반드시 보완이 필요합니다.

### 최종 판정

| 판정 | 조건 |
|------|------|
| **조건부 승인** | P1 이슈 해결 후 구현 진행 가능 |

### P1 이슈 해결 필수 항목
1. **S-01**: 설계 문서에 "서버 사이드 유효성 검사 필수" 원칙 추가
2. **S-02**: XSS 방어 전략 및 React 보안 활용 원칙 추가
3. **Q-01**: 추적성 매트릭스의 테스트 수량을 테스트 명세서와 동기화

---

## 변경 이력

| 버전 | 일자 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0 | 2026-01-21 | claude-1 | 최초 작성 - 설계 리뷰 |

---

---

## 8. 적용 결과

**적용일**: 2026-01-21
**적용자**: Claude

### 8.1 적용 판단 요약

| 판단 | 건수 | 이슈 ID |
|------|------|---------|
| ✅ 적용 | 9건 | S-01, S-02, Q-01, A-01, S-03, Q-02, Q-03, Q-04, Q-05 |
| 📝 조정 적용 | 5건 | A-04, S-04, S-05, Q-06, Q-07 |
| ⏸️ 보류 | 4건 | A-02, A-03, S-06, Q-08 |

### 8.2 적용된 이슈 상세

| 이슈 ID | 우선순위 | 적용 내용 | 수정 문서 |
|---------|---------|----------|----------|
| **S-01** | P1 | 서버 사이드 유효성 검사 원칙 명시 (10.1절 추가) | 010-design.md |
| **S-02** | P1 | XSS 방어 전략 정의 (10.2절 추가) | 010-design.md |
| **Q-01** | P1 | 단위 테스트 수량 동기화 (13개→15개) | 025-traceability-matrix.md |
| **A-01** | P2 | useFormDirty 훅 제네릭 타입 바운드 추가 | 010-design.md |
| **S-03** | P2 | CSRF 방어 원칙 명시 (10.3절 추가) | 010-design.md |
| **Q-02** | P2 | 요구사항 ID 매핑 수정 (FR-005~FR-008 정리) | 025-traceability-matrix.md |
| **Q-03** | P2 | FR-005 폼 초기화/리셋 추가 | 025-traceability-matrix.md |
| **Q-04** | P2 | data-testid `form-reset-btn` 추가 | 026-test-specification.md |
| **Q-05** | P2 | E2E 테스트 수량 동기화 (8개→10개) | 025-traceability-matrix.md |
| **A-04** | P4 | Form 인스턴스 관리 정책 명확화 (텍스트 설명) | 010-design.md |
| **S-04** | P3 | 에러 메시지 보안 가이드라인 (10.4절 추가) | 010-design.md |
| **S-05** | P3 | 민감 데이터 처리 가이드라인 (10.5절 추가) | 010-design.md |
| **Q-06** | P3 | 비즈니스 규칙 ID 통일 (BR-001~BR-006) | 025-traceability-matrix.md |
| **Q-07** | P3 | 매뉴얼 테스트 수량 동기화 (4개→12개) | 025-traceability-matrix.md |

### 8.3 보류된 이슈 상세

| 이슈 ID | 우선순위 | 보류 사유 |
|---------|---------|----------|
| **A-02** | P3 | Compound Component 패턴 - 구조 대규모 변경 필요, 현재 설계로 충분히 작동 |
| **A-03** | P3 | 브라우저/SPA 이탈 경고 통합 - MDI 탭 구조 미확정, 구현 단계에서 상세화 |
| **S-06** | P4 | 세션 만료 처리 상세화 - 인증 모듈(별도 Task) 범위 |
| **Q-08** | P4 | 커버리지 통계 업데이트 - 다른 이슈 적용으로 자동 해결됨 |

### 8.4 적용 완료 확인

- [x] P1 이슈 100% 처리
- [x] P2 이슈 100% 처리
- [x] 모든 이슈에 적용/보류 근거 명시
- [x] 기본설계-추적성 매트릭스-테스트 명세서 일관성 유지

---

<!--
Task: TSK-06-03 입력/수정 폼 템플릿
Review Type: Design Review
Reviewer: claude-1
Status: 적용 완료
Applied: 2026-01-21
-->
