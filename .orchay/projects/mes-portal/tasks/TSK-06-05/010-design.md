# TSK-06-05 - 팝업(모달) 화면 템플릿 설계 문서

## 문서 정보

| 항목 | 내용 |
|------|------|
| Task ID | TSK-06-05 |
| 문서 버전 | 1.1 |
| 작성일 | 2026-01-20 |
| 상태 | 리뷰반영 |
| 카테고리 | development |

---

## 1. 개요

### 1.1 배경 및 문제 정의

**현재 상황:**
- 모달 팝업에서 항목을 검색하고 선택하는 패턴이 반복됨
- 부모 화면에 선택 값을 전달하는 로직이 매번 구현됨

**해결하려는 문제:**
- 선택형 팝업 화면의 표준 템플릿 부재
- 검색/선택/전달 로직 중복

### 1.2 목적 및 기대 효과

**목적:**
- 재사용 가능한 선택형 팝업 템플릿 제공
- 검색, 목록, 단일/다중 선택, 값 전달 표준화

**기대 효과:**
- 팝업 화면 개발 간소화
- 일관된 팝업 UX

### 1.3 범위

**포함:**
- SelectPopupTemplate 컴포넌트 구현
- 모달 기반 레이아웃
- 검색 및 목록
- 단일/다중 선택
- 선택 완료 시 콜백

**제외:**
- 모달 외 팝업 (Drawer 등)

### 1.4 참조 문서

| 문서 | 경로 | 관련 섹션 |
|------|------|----------|
| PRD | `.orchay/projects/mes-portal/prd.md` | 4.1.1 화면 템플릿 - 팝업 화면 |
| TRD | `.orchay/projects/mes-portal/trd.md` | Ant Design Modal |

---

## 2. 사용자 분석

### 2.1 대상 사용자

| 사용자 유형 | 특성 | 주요 니즈 |
|------------|------|----------|
| 데이터 입력자 | 참조 데이터 선택 필요 | 빠른 검색, 쉬운 선택 |
| 관리자 | 다중 항목 선택 | 일괄 선택 기능 |

---

## 3. 유즈케이스

### 3.1 유즈케이스 다이어그램

```mermaid
flowchart LR
    subgraph 팝업템플릿
        UC01[UC-01: 팝업 열기]
        UC02[UC-02: 항목 검색]
        UC03[UC-03: 항목 선택]
        UC04[UC-04: 선택 확인]
        UC05[UC-05: 팝업 닫기]
    end

    사용자((사용자)) --> UC01
    UC01 --> UC02
    UC02 --> UC03
    UC03 --> UC04
    UC04 --> UC05
```

### 3.2 유즈케이스 상세

#### UC-03: 항목 선택

| 항목 | 내용 |
|------|------|
| 액터 | 일반 사용자 |
| 목적 | 원하는 항목 선택 |
| 사전 조건 | 팝업 열림, 목록 표시 |
| 사후 조건 | 선택 상태 표시 |
| 트리거 | 행 클릭 또는 체크박스 |

---

## 4. 사용자 시나리오

### 4.1 시나리오 1: 단일 항목 선택

**상황 설명:**
폼에서 참조 데이터(예: 담당자)를 선택하기 위해 팝업을 연다.

**단계별 진행:**

| 단계 | 사용자 행동 | 시스템 반응 | 사용자 기대 |
|------|-----------|------------|------------|
| 1 | 돋보기 버튼 클릭 | 팝업 열림 | 즉시 반응 |
| 2 | 검색어 입력 | 목록 필터링 | 실시간 필터 |
| 3 | 항목 클릭 | 행 선택 강조 | 선택 확인 |
| 4 | 확인 클릭 | 팝업 닫힘, 값 전달 | 부모 폼에 값 반영 |

### 4.2 시나리오 2: 다중 항목 선택

**상황 설명:**
여러 항목을 한 번에 선택해야 한다.

**단계별 진행:**

| 단계 | 사용자 행동 | 시스템 반응 | 사용자 기대 |
|------|-----------|------------|------------|
| 1 | 체크박스로 여러 항목 선택 | 선택 개수 표시 | 선택 현황 확인 |
| 2 | 전체 선택 클릭 | 모든 항목 선택 | 일괄 선택 |
| 3 | 확인 클릭 | 선택 배열 전달 | 모든 값 반영 |

---

## 5. 화면 설계

### 5.1 화면별 상세

#### 화면 1: 선택형 팝업 템플릿

**화면 목적:**
항목 검색 및 선택 후 부모 화면에 값 전달

**와이어프레임:**
```
┌─────────────────────────────────────────────────────────────────┐
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  🔍 {제목} 선택                                      [✕]  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  ┌─────────────────────────────────────┐  [🔍 검색]       │  │
│  │  │ 검색어 입력...                      │                  │  │
│  │  └─────────────────────────────────────┘                  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  ☐ 전체 선택                           선택: 2건 / 10건   │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │ ☑ │ 항목명1       │ 설명1                           │  │  │
│  │  │ ☐ │ 항목명2       │ 설명2                           │  │  │
│  │  │ ☑ │ 항목명3       │ 설명3                           │  │  │
│  │  │ ☐ │ 항목명4       │ 설명4                           │  │  │
│  │  │ ☐ │ 항목명5       │ 설명5                           │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  │                                                            │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │              < 1 2 3 >                               │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                                     [취소]  [✓ 선택완료]  │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

**화면 요소 설명:**

| 영역 | 설명 | 사용자 인터랙션 |
|------|------|----------------|
| 모달 헤더 | 제목 및 닫기 | X 클릭 시 닫기 |
| 검색 영역 | 필터링 입력 | 검색어 입력 |
| 목록 영역 | 선택 가능한 항목 | 체크박스/행 클릭 |
| 선택 현황 | 선택 개수 표시 | - |
| 하단 버튼 | 취소/선택완료 | 확인/취소 액션 |

---

## 6. 인터랙션 설계

### 6.1 사용자 액션과 피드백

| 사용자 액션 | 즉각 피드백 | 결과 피드백 | 에러 피드백 |
|------------|-----------|------------|------------|
| 검색 입력 | 목록 필터링 | - | 결과 없음 |
| 행 클릭 (단일) | 선택 강조 | - | - |
| 체크박스 (다중) | 체크 표시, 개수 갱신 | - | - |
| 선택완료 클릭 | 모달 닫힘 | 부모에 값 전달 | 선택 없으면 경고 |

### 6.2 상태별 화면 변화

| 상태 | 화면 표시 | 사용자 안내 |
|------|----------|------------|
| 로딩 중 | 목록 Skeleton | - |
| 데이터 없음 | Empty 표시 | "검색 결과가 없습니다" |
| 선택 없음 | 선택완료 버튼 비활성화 | - |

### 6.3 검색 디바운스

| 항목 | 설정 |
|------|------|
| 기본 지연 시간 | 300ms (`searchDebounceMs` prop으로 조정 가능) |
| 구현 방식 | `useDebouncedCallback` 또는 `lodash.debounce` 사용 |
| 동작 | 마지막 입력 후 지연 시간 경과 시 `onSearch` 콜백 호출 |

---

## 7. 보안 요구사항

### 7.1 XSS 방어 가이드라인 (SEC-002)

**컬럼 render 함수 사용 시 주의사항:**

| 패턴 | 안전성 | 예시 |
|------|--------|------|
| React 기본 텍스트 | ✅ 안전 | `render: (text) => <span>{text}</span>` |
| dangerouslySetInnerHTML | ❌ 위험 (금지) | `render: (text) => <div dangerouslySetInnerHTML={{...}} />` |
| HTML 문자열 직접 삽입 | ❌ 위험 (금지) | 사용자 입력값을 HTML로 변환 금지 |

### 7.2 검색 입력값 Sanitization (SEC-001)

| 항목 | 규칙 |
|------|------|
| 검색어 최대 길이 | 100자 제한 |
| 제어 문자 처리 | 자동 제거 |
| 서버 검색 시 | SQL Injection 방지는 서버 측 책임 |
| 특수문자 이스케이프 | 클라이언트 필터링 시 정규표현식 이스케이프 처리 |

### 7.3 데이터 노출 제한

| 항목 | 가이드라인 |
|------|-----------|
| 표시 컬럼 | 팝업에 표시할 컬럼은 필요 최소한의 정보만 포함 |
| 민감 정보 | 주민번호, 비밀번호 등 민감 정보 컬럼 포함 금지 |
| 권한 검증 | 팝업 표시 전 데이터 접근 권한 검증은 부모 컴포넌트 책임 |

---

## 8. 데이터 요구사항

### 8.1 Props 인터페이스

```typescript
import type { ColumnType, TablePaginationConfig } from 'antd/es/table'
import type { ReactNode } from 'react'

interface SelectPopupTemplateProps<T extends Record<string, unknown>> {
  // 모달 설정
  open: boolean
  onClose: () => void
  title: string
  width?: number | string

  // 데이터
  columns: ColumnType<T>[]
  dataSource: T[]
  loading?: boolean
  rowKey: keyof T | ((record: T) => string)

  // 선택
  multiple?: boolean
  selectedKeys?: (string | number)[]
  onSelect: (selectedRows: T[]) => void
  selectOnRowClick?: boolean  // 단일 선택 시 즉시 완료 여부 (기본값: false)

  // 검색
  searchPlaceholder?: string
  onSearch?: (keyword: string) => void
  searchMode?: 'client' | 'server'  // 검색 모드 (기본값: 'client')
  searchDebounceMs?: number  // 서버 검색 시 디바운스 설정 (기본값: 300)
  searchFields?: (keyof T)[]  // 클라이언트 검색 시 필터링 대상 필드

  // 페이지네이션 (서버 모드 시 controlled)
  pagination?: TablePaginationConfig | false
  onPaginationChange?: (page: number, pageSize: number) => void
  total?: number  // 서버 페이지네이션 시 전체 건수

  // 권한 관리
  permissions?: {
    canSelect?: boolean  // 선택 권한 (기본: true)
  }

  // 에러 상태
  error?: {
    message?: string
    onRetry?: () => void
  }

  // 슬롯 기반 커스터마이징
  searchExtra?: ReactNode  // 검색 영역 추가 요소
  tableHeader?: ReactNode  // 테이블 상단 추가 요소
  footer?: ReactNode | ((selectedRows: T[]) => ReactNode)  // 커스텀 푸터
}
```

---

## 8. 비즈니스 규칙

### 8.1 핵심 규칙

| 규칙 ID | 규칙 설명 | 적용 상황 |
|---------|----------|----------|
| BR-01 | 단일 선택 시 행 클릭으로 선택 | multiple=false |
| BR-02 | 다중 선택 시 체크박스 사용 | multiple=true |
| BR-03 | 선택 없이 확인 불가 | 선택완료 클릭 시 |

---

## 9. 에러 처리

### 9.1 예상 에러 상황

| 상황 | 원인 | 사용자 메시지 | 복구 방법 |
|------|------|--------------|----------|
| 조회 실패 | 네트워크 오류 | "데이터를 불러오지 못했습니다" | 재시도 버튼 (테이블 영역 중앙, error.onRetry 콜백 호출) |
| 선택 없음 | 사용자 실수 | "항목을 선택해주세요" | 토스트 안내 |

---

## 10. 연관 문서

| 문서 | 경로 | 용도 |
|------|------|------|
| 요구사항 추적 매트릭스 | `025-traceability-matrix.md` | PRD → 설계 → 테스트 추적 |
| 테스트 명세서 | `026-test-specification.md` | 테스트 케이스 정의 |

---

## 11. 구현 범위

### 11.1 파일 구조

```
components/templates/SelectPopupTemplate/
├── index.tsx                 # 메인 컴포넌트 (re-export)
├── SelectPopupTemplate.tsx   # 템플릿 구현체
├── types.ts                  # Props 인터페이스 정의
└── __tests__/
    └── SelectPopupTemplate.spec.tsx  # 단위 테스트
```

### 11.2 Server/Client Component 구분

| 컴포넌트 | 타입 | 사유 |
|----------|------|------|
| SelectPopupTemplate | Client Component | Ant Design Modal/Table 사용, 상태 관리 필요 |
| 부모 페이지 | Server Component (권장) | 초기 데이터 페칭 수행 |

> 'use client' 지시어를 SelectPopupTemplate.tsx 최상단에 선언

### 11.3 영향받는 영역

| 영역 | 변경 내용 | 영향도 |
|------|----------|--------|
| components/templates/ | SelectPopupTemplate 디렉토리 신규 | 높음 |

### 11.4 의존성

| 의존 항목 | 이유 | 상태 |
|----------|------|------|
| Ant Design Modal | 기반 컴포넌트 | 완료 |
| Ant Design Table | 목록 표시 | 완료 |

---

## 12. 체크리스트

### 12.1 설계 완료 확인

- [x] 문제 정의 및 목적 명확화
- [x] 사용자 분석 완료
- [x] 유즈케이스 정의 완료
- [x] 사용자 시나리오 작성 완료
- [x] 화면 설계 완료 (와이어프레임)
- [x] 인터랙션 설계 완료
- [x] 데이터 요구사항 정의 완료
- [x] 비즈니스 규칙 정의 완료
- [x] 에러 처리 정의 완료

---

## 변경 이력

| 버전 | 일자 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0 | 2026-01-20 | Claude | 최초 작성 |
| 1.1 | 2026-01-21 | Claude | 설계 리뷰 반영 (ARCH-001~008, QA-001~010, SEC-001~005) |
