# 설계 리뷰 - TSK-07-02 KPI 카드 위젯

## 리뷰 정보

| 항목 | 내용 |
|------|------|
| Task ID | TSK-07-02 |
| Task명 | KPI 카드 위젯 |
| 리뷰어 | claude-1 |
| 리뷰 일자 | 2026-01-21 |
| 리뷰 대상 문서 | 010-design.md, 025-traceability-matrix.md, 026-test-specification.md |

---

## 1. 검증 대상

| 문서 | 상태 | 비고 |
|------|------|------|
| 010-design.md | PASS | 통합설계 완료 |
| 025-traceability-matrix.md | WARN | 설계 문서와 불일치 발견 |
| 026-test-specification.md | WARN | 데이터 모델 불일치 발견 |

---

## 2. 검증 결과 요약

| 검증 영역 | 평가 | 비고 |
|----------|------|------|
| 문서 완전성 | PASS | 필수 섹션 모두 포함 |
| 요구사항 추적성 | WARN | BR 정의 불일치 (P1) |
| 아키텍처 | PASS | SOLID 원칙 준수 |
| 보안 | PASS | 해당 없음 (UI 컴포넌트) |
| 테스트 가능성 | WARN | data-testid 명명 불일치 |

**이슈 분포: P1(2) P2(3) P3(2) P4(2) P5(2) = 11건**

---

## 3. 아키텍처 리뷰 결과

### 3.1 SOLID 원칙 검토

| 원칙 | 평가 | 설명 |
|------|------|------|
| SRP (단일 책임) | PASS | `KPICard`는 KPI 표시, `ChangeIndicator`는 증감률 표시, `KPICardGroup`은 카드 배치라는 명확한 단일 책임 |
| OCP (개방-폐쇄) | PASS | `KPI_CONFIG`와 `KPI_ICON_MAP`을 통해 새 KPI 유형 추가 시 기존 컴포넌트 수정 없이 설정만 확장 가능 |
| LSP (리스코프 치환) | PASS | `KPICardData` 인터페이스를 준수하는 모든 데이터는 동일하게 처리됨 |
| ISP (인터페이스 분리) | PASS | 목적별로 인터페이스가 분리됨 |
| DIP (의존성 역전) | WARN | `useKPICards` 훅이 JSON import에 직접 의존. 데이터 소스 추상화 레이어 부재 |

### 3.2 컴포넌트 구조

```
┌─────────────────────────────────────────────────────┐
│  Presentation Layer                                  │
│  └─ KPICardGroup (레이아웃 담당)                    │
│       └─ KPICard (개별 카드 렌더링)                 │
│            └─ ChangeIndicator (증감률 표시)         │
├─────────────────────────────────────────────────────┤
│  Data Access Layer                                   │
│  └─ useKPICards (데이터 로딩 훅)                    │
├─────────────────────────────────────────────────────┤
│  Configuration Layer                                 │
│  └─ kpiConfig.ts (KPI_CONFIG, KPI_ICON_MAP)        │
├─────────────────────────────────────────────────────┤
│  Type Layer                                          │
│  └─ types.ts (인터페이스 정의)                      │
└─────────────────────────────────────────────────────┘
```

**평가: 우수** - 컴포넌트 책임이 명확히 분리되어 유지보수성 높음

### 3.3 확장성 검토

| 항목 | 평가 | 설명 |
|------|------|------|
| 새 KPI 유형 추가 | 우수 | 설정 기반 확장으로 대응 가능 |
| 표시 형식 변경 | 양호 | 숫자 포맷팅, 아이콘 변경 용이. 카드 레이아웃 자체 변경은 컴포넌트 수정 필요 |
| API 연동 전환 | 보통 | `useKPICards` 훅 내부 수정 필요 (추상화 권장) |

---

## 4. 품질 리뷰 결과

### 4.1 문서 완전성

| 섹션 | 포함 여부 | 비고 |
|------|----------|------|
| 개요 | O | 배경, 목적, 범위, 참조 문서 포함 |
| 유즈케이스 | O | UC-01~UC-04 정의, 다이어그램 포함 |
| 화면 설계 | O | 와이어프레임, 상태별 화면, 반응형 동작 정의 |
| 데이터 요구사항 | O | JSON 구조, 타입 정의, 유효성 규칙 포함 |
| 비즈니스 규칙 | O | BR-01~BR-08 정의, 코드 예시 포함 |
| 에러 처리 | O | 예상 에러 상황, 표시 방식, 코드 예시 포함 |
| 구현 범위 | O | 파일 구조, 의존성, data-testid 정의 포함 |

### 4.2 요구사항 추적성

| 구분 | 총 항목 | 매핑 완료 | 커버리지 |
|------|---------|----------|---------|
| 기능 요구사항 (FR) | 5 | 5 | 100% |
| 비즈니스 규칙 (BR) - 설계 문서 | 8 | 8 | 100% |
| 비즈니스 규칙 (BR) - 추적성 매트릭스 | 8 | 4 | **50%** |

### 4.3 테스트 가능성

| 테스트 유형 | 테스트 케이스 수 | 목표 커버리지 |
|-------------|-----------------|--------------|
| 단위 테스트 (UT) | 11개 | 80% 이상 |
| E2E 테스트 | 4개 | 100% 시나리오 |
| 매뉴얼 테스트 (TC) | 6개 | 전체 화면 |

---

## 5. 발견된 이슈

### 5.1 Critical (P1) - 구현 전 필수 수정

| ID | 카테고리 | 설명 | 권장 조치 |
|----|----------|------|----------|
| CR-001 | 비즈니스 규칙 | 설계 문서의 BR-001~BR-004(긍정/부정 KPI 유형에 따른 색상 규칙)와 추적성 매트릭스의 BR-001~BR-004(단순 양수/음수 증감률 색상 규칙)가 완전히 다름. **불량률의 경우 증가 시 빨간색, 감소 시 녹색이어야 하는 특수 규칙이 테스트에 반영되지 않음** | 추적성 매트릭스의 BR 정의를 설계 문서와 일치시키고, 긍정/부정 KPI 유형 개념 반영 필요 |
| CR-002 | 추적성 | 설계 문서의 BR-005~BR-008(neutral 회색, 천단위 콤마, 소수점 1자리, 정수 표시)이 추적성 매트릭스에 누락됨 | 추적성 매트릭스에 BR-005~BR-008 추가 |

### 5.2 High (P2) - 구현 초기 수정

| ID | 카테고리 | 설명 | 권장 조치 |
|----|----------|------|----------|
| HI-001 | 데이터 불일치 | 설계 문서의 KPI ID(`production`, `efficiency`, `defect`, `orders`)와 테스트 명세서의 type(`operationRate`, `defectRate`, `productionVolume`)이 불일치 | 하나의 명명 규칙으로 통일 (설계 문서 기준 권장) |
| HI-002 | 누락 | 작업지시(orders) 카드가 테스트 명세서와 추적성 매트릭스에서 누락됨 | 작업지시 카드에 대한 테스트 케이스 및 추적성 매핑 추가 |
| HI-003 | 의존성 | `useKPICards` 훅이 JSON import에 직접 의존. TRD 섹션 2.3의 `USE_MOCK` 환경변수 분기 패턴 미적용 | 데이터 소스 추상화 레이어 추가 |

### 5.3 Medium (P3) - 구현 중 수정

| ID | 카테고리 | 설명 | 권장 조치 |
|----|----------|------|----------|
| MD-001 | data-testid | 설계 문서와 테스트 명세서 간 data-testid 명명 규칙 불일치. 설계: `kpi-card-{id}`, `kpi-value-{id}`, `kpi-change-{id}` vs 테스트: `kpi-card-{type}`, `kpi-value`, `kpi-change-rate` | data-testid 명명 규칙 통일 필요 |
| MD-002 | 타입 정의 | 테스트 명세서의 KPICardProps 인터페이스가 설계 문서의 인터페이스와 다름. 특히 `type` vs `id` 필드, `changeRate` vs `change`+`changeType` 구조 차이 | Props 인터페이스 통일 필요 |

### 5.4 Low (P4) - 구현 후 검토

| ID | 카테고리 | 설명 | 권장 조치 |
|----|----------|------|----------|
| LO-001 | Mock 데이터 | 설계 문서의 dashboard.json 구조(`kpiCards` 배열)와 추적성 매트릭스/테스트 명세서의 구조(`kpi` 객체)가 다름 | Mock 데이터 구조 통일 |
| LO-002 | 문서 정합성 | 추적성 매트릭스의 FR-002 단위 테스트가 UT-003, UT-004로 매핑되어 있으나, 테스트 명세서에서 UT-003은 생산량 카드(FR-003)를 테스트함 | 테스트 ID 매핑 수정 필요 |

### 5.5 Info (P5) - 참고 사항

| ID | 카테고리 | 설명 | 권장 조치 |
|----|----------|------|----------|
| IN-001 | 타입 안정성 | `KPI_CONFIG`의 `valueType`이 KPI ID 문자열을 키로 사용 | `KPIId` 유니온 타입 정의 권장 |
| IN-002 | 테스트 용이성 | `useKPICards` 훅의 데이터 로딩 함수가 훅 내부에 정의되어 있어 모킹 어려움 | 데이터 fetcher 함수를 외부에서 주입받는 구조로 개선 시 테스트 용이성 향상 |

---

## 6. 총평

### 6.1 강점

1. **설계 문서 완성도**: 010-design.md가 모든 필수 섹션을 포함하고, 상세한 와이어프레임 및 코드 예시 제공
2. **SOLID 원칙 준수**: 컴포넌트 분할이 명확하고 설정 기반 확장이 가능한 구조
3. **비즈니스 규칙 상세화**: 긍정/부정 KPI 유형에 따른 증감률 색상 규칙이 설계 문서에 명확히 정의됨
4. **TRD 준수**: Ant Design 컴포넌트(Card, Statistic, Row/Col) 우선 사용 지침 준수

### 6.2 개선 필요 사항

1. **[Critical]** 설계 문서와 추적성 매트릭스/테스트 명세서 간 비즈니스 규칙 정의 불일치가 심각함
2. **[High]** 작업지시(orders) 카드가 설계에는 있으나 테스트 범위에서 누락됨
3. **[High]** KPI ID/type 명명 규칙, data-testid 명명 규칙, Props 인터페이스 구조가 문서 간 불일치
4. **[Medium]** 숫자 포맷팅 규칙(BR-06~BR-08)에 대한 테스트 커버리지 명확화 필요

### 6.3 결론

**전반적인 품질 평가: B+ (양호)**

- 아키텍처 품질: **우수 (4/5)**
- 품질 평가: **양호 (B+)**

설계 문서 자체의 완성도는 높으나, 추적성 매트릭스와 테스트 명세서가 설계 문서의 비즈니스 규칙을 정확히 반영하지 못하고 있습니다. 특히 **불량률(defect) KPI의 증감률 색상 규칙**이 테스트에서 잘못 검증될 수 있는 위험이 있으므로, `/wf:apply` 단계에서 P1 이슈들을 우선적으로 수정해야 합니다.

---

## 7. 권장 조치 우선순위

1. **[P1] 추적성 매트릭스 수정**: BR-001~BR-008 정의를 설계 문서와 일치시키기
2. **[P2] 테스트 명세서 수정**:
   - KPI ID 명명 규칙 통일 (설계 문서 기준)
   - 작업지시(orders) 카드 테스트 케이스 추가
   - data-testid 명명 규칙 통일
3. **[P2] 데이터 소스 추상화**: `useKPICards` 훅에 USE_MOCK 환경변수 분기 적용
4. **[P4] Mock 데이터 구조 통일**: dashboard.json 구조 확정

---

## 변경 이력

| 버전 | 일자 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0 | 2026-01-21 | claude-1 | 최초 작성 |

---

<!--
Task: TSK-07-02 KPI 카드 위젯
Domain: frontend
Category: development
Created: 2026-01-21
-->
